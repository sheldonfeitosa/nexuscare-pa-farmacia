<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de controle de leitos e comunica√ß√£o entre Pronto Atendimento e Farm√°cia - NexusCare">
    <meta name="keywords" content="hospital, pronto atendimento, farm√°cia, controle de leitos, gest√£o de pacientes">
    <meta name="author" content="NexusCare Team">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="NexusCare - Sistema de Controle de Leitos">
    <meta property="og:description" content="Sistema completo para gest√£o de pacientes entre PA e Farm√°cia">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#667eea">
    <title>NexusCare - Conectando o cuidado, ponto a ponto</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .logo-text {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header h1 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        .user-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .view-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            color: #6c757d;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .view-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        .view-btn:hover::before {
            left: 100%;
        }
        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .view-btn.active {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        .view-btn i {
            margin-right: 8px;
            font-size: 1.1rem;
        }
        .main-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .panel {
            display: none;
        }
        .panel.active {
            display: block;
        }
        .panel h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .panel h2 i {
            color: #3498db;
        }
        .leitos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .leito-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #95a5a6;
            transition: all 0.3s ease;
        }
        .leito-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .leito-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .leito-id {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            background: #95a5a6;
            color: white;
        }
        .status-badge.ocupado {
            background: #e74c3c;
        }
        .leito-info {
            margin-bottom: 15px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        .info-label {
            font-weight: bold;
            color: #7f8c8d;
        }
        .info-value {
            color: #2c3e50;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            background: #3498db;
            color: white;
            width: 100%;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-warning {
            background: #f39c12;
        }
        .btn-warning:hover {
            background: #e67e22;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 1% auto;
            padding: 15px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: #000;
        }
        
        /* Responsividade para modais em telas pequenas */
        @media (max-height: 600px) {
            .modal-content {
                margin: 0.5% auto;
                padding: 10px;
                max-height: 98vh;
            }
            .form-group {
                margin-bottom: 8px;
            }
            .form-group input, .form-group select, .form-group textarea {
                padding: 6px;
            }
        }
        
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 0.5% auto;
                padding: 10px;
            }
        }
        .form-group {
            margin-bottom: 12px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        .form-group input:invalid, .form-group select:invalid {
            border-color: #e74c3c;
        }
        .form-group input:valid, .form-group select:valid {
            border-color: #27ae60;
        }
        .required-field::after {
            content: " *";
            color: #e74c3c;
        }
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            resize: vertical;
            min-height: 80px;
        }
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        .char-counter {
            text-align: right;
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 2px;
        }
        .char-counter.warning {
            color: #f39c12;
        }
        .char-counter.danger {
            color: #e74c3c;
        }
        .btn-primary {
            background: #27ae60;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
        }
        .btn-primary:hover {
            background: #229954;
        }
        .paciente-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        .paciente-info h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        .paciente-info p {
            margin: 5px 0;
            color: #7f8c8d;
        }
        
        .email-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            min-width: 200px;
            background: white;
        }
        
        .email-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        /* ESTILOS DO LOGIN */
        .login-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .login-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            max-width: 450px;
            width: 100%;
            text-align: center;
            margin: auto;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .login-header {
            margin-bottom: 20px;
        }
        
        .login-header h2 {
            color: #2c3e50;
            font-size: 16px;
            margin: 10px 0 5px 0;
            line-height: 1.3;
        }
        
        .login-header p {
            color: #6c757d;
            font-size: 12px;
            margin: 0;
        }
        
        .login-form h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .login-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 12px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        
        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }
        
        .btn-login {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 20px;
        }
        
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-cadastro {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-cadastro:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .login-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: left;
        }
        
        .login-info h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 14px;
        }
        
        .usuarios-demo {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .usuario-demo {
            font-size: 12px;
            color: #6c757d;
            line-height: 1.3;
        }
        
        .usuario-demo code {
            background: #e9ecef;
            padding: 1px 4px;
            border-radius: 2px;
            font-family: monospace;
            font-size: 11px;
        }
        
        /* ESTILOS DO HEADER COM USUARIO */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-left: auto;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .user-details {
            text-align: right;
        }
        
        .user-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .user-role {
            color: #6c757d;
            font-size: 12px;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        /* RESPONSIVIDADE PARA LOGIN */
        @media (max-height: 700px) {
            .login-container {
                padding: 20px;
                max-height: 95vh;
            }
            
            .login-header {
                margin-bottom: 15px;
            }
            
            .login-header h2 {
                font-size: 14px;
                margin: 8px 0 4px 0;
            }
            
            .login-header p {
                font-size: 11px;
            }
            
            .login-form h3 {
                font-size: 18px;
                margin-bottom: 15px;
            }
            
            .login-input {
                padding: 8px 10px;
                font-size: 13px;
                margin-bottom: 10px;
            }
            
            .btn-login {
                padding: 10px;
                font-size: 14px;
                margin-bottom: 15px;
            }
            
            .login-info {
                padding: 12px;
            }
            
            .login-info h4 {
                font-size: 13px;
                margin-bottom: 8px;
            }
            
            .usuario-demo {
                font-size: 11px;
                gap: 3px;
            }
            
            .usuario-demo code {
                font-size: 10px;
                padding: 1px 3px;
            }
        }
        
        @media (max-height: 600px) {
            .login-container {
                padding: 15px;
            }
            
            .login-header {
                margin-bottom: 10px;
            }
            
            .login-header h2 {
                font-size: 13px;
                margin: 5px 0 3px 0;
            }
            
            .login-header p {
                font-size: 10px;
            }
            
            .login-form h3 {
                font-size: 16px;
                margin-bottom: 12px;
            }
            
            .login-input {
                padding: 7px 9px;
                font-size: 12px;
                margin-bottom: 8px;
            }
            
            .btn-login {
                padding: 8px;
                font-size: 13px;
                margin-bottom: 12px;
            }
            
            .login-info {
                padding: 10px;
            }
            
            .login-info h4 {
                font-size: 12px;
                margin-bottom: 6px;
            }
            
            .usuario-demo {
                font-size: 10px;
                gap: 2px;
            }
        }
        
        @media (max-height: 500px) {
            .login-container {
                padding: 10px;
                max-height: 98vh;
            }
            
            .login-header {
                margin-bottom: 8px;
            }
            
            .login-header h2 {
                font-size: 12px;
                margin: 3px 0 2px 0;
            }
            
            .login-header p {
                font-size: 9px;
            }
            
            .login-form h3 {
                font-size: 14px;
                margin-bottom: 10px;
            }
            
            .login-input {
                padding: 6px 8px;
                font-size: 11px;
                margin-bottom: 6px;
            }
            
            .btn-login {
                padding: 6px;
                font-size: 12px;
                margin-bottom: 10px;
            }
            
            .login-info {
                padding: 8px;
            }
            
            .login-info h4 {
                font-size: 11px;
                margin-bottom: 4px;
            }
            
            .usuario-demo {
                font-size: 9px;
                gap: 1px;
            }
            
            .usuario-demo code {
                font-size: 8px;
                padding: 1px 2px;
            }
        }
        
        /* DASHBOARD STYLES */
        .dashboard-filters {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .time-filter-container h3 {
            color: white;
            margin: 0 0 20px 0;
            font-size: 1.2rem;
        }
        
        .time-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .time-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }
        
        .time-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .time-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .custom-time {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .time-input {
            padding: 10px 15px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .time-input::placeholder {
            color: rgba(255,255,255,0.7);
        }
        
        .btn-custom {
            background: white;
            color: #667eea;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .stat-icon {
            font-size: 3rem;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            color: white;
        }
        
        .stat-content h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-change {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .stat-change.positive {
            color: #27ae60;
        }
        
        .stat-change.negative {
            color: #e74c3c;
        }
        
        .dashboard-charts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .chart-container h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }
        
        .chart {
            height: 200px;
            position: relative;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: end;
            justify-content: space-around;
        }
        
        .chart-bars {
            display: flex;
            align-items: end;
            gap: 10px;
            height: 100%;
            width: 100%;
        }
        
        .chart-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px 5px 0 0;
            min-width: 30px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .chart-bar:hover {
            transform: scaleY(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .chart-line {
            height: 100%;
            width: 100%;
            position: relative;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
        }
        
        .dashboard-timeline {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .dashboard-timeline h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }
        
        .timeline-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-left: 3px solid #667eea;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 0 10px 10px 0;
            transition: all 0.3s ease;
        }
        
        .timeline-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .timeline-icon.admissao {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }
        
        .timeline-icon.transferencia {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .timeline-icon.alta {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .timeline-time {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .dashboard-alerts {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .dashboard-alerts h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }
        
        .alerts-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .alert-item {
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        
        .alert-item.info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2196f3;
        }
        
        .alert-item.warning {
            background: linear-gradient(135deg, #fff3e0 0%, #ffcc02 100%);
            border-left: 4px solid #ff9800;
        }
        
        .alert-item.success {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-left: 4px solid #4caf50;
        }
        
        .alert-icon {
            font-size: 1.5rem;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .alert-message {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* Tabelas */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:hover {
            background: #f8f9fa;
        }
        
        /* Filtros */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-input {
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .filter-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        /* Estatisticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        /* Farmacia Cards */
        .farmacia-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .farmacia-card {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #27ae60;
            transition: all 0.3s ease;
        }
        .farmacia-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .farmacia-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .farmacia-card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .farmacia-card-leito {
            background: #27ae60;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .farmacia-card-info {
            margin-bottom: 15px;
        }
        .farmacia-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        .farmacia-info-label {
            font-weight: 600;
            color: #7f8c8d;
        }
        .farmacia-info-value {
            color: #2c3e50;
        }
        .farmacia-observacoes {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid #27ae60;
        }
        .farmacia-observacoes-label {
            font-weight: 600;
            color: #27ae60;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .farmacia-observacoes-value {
            color: #2c3e50;
            font-size: 0.9rem;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-brain"></div>
                    <div class="logo-text">INMCEB</div>
                </div>
                <div>
                    <h1>INSTITUTO DE MEDICINA DO COMPORTAMENTO EURIPEDES BARSANULFO</h1>
                </div>
            </div>
            <div class="user-selector">
                <button class="view-btn active" onclick="mostrarPA()">
                    <i class="fas fa-user-md"></i>
                    Pronto Atendimento
                </button>
                <button class="view-btn" onclick="mostrarFarmacia()">
                    <i class="fas fa-pills"></i>
                    Farmacia
                </button>
                <button class="view-btn" onclick="mostrarRastreabilidade()">
                    <i class="fas fa-search"></i>
                    Rastreabilidade
                </button>
                <button class="view-btn" onclick="mostrarRelatorios()">
                    <i class="fas fa-chart-bar"></i>
                    Relatorios
                </button>
                <button class="view-btn" onclick="mostrarConfigEmail()">
                    <i class="fas fa-envelope"></i>
                    Configurar Emails
                </button>
                <button class="view-btn" onclick="mostrarConfigAvancada()">
                    <i class="fas fa-cogs"></i>
                    Configura√ß√µes Avan√ßadas
                </button>
                <button class="view-btn" onclick="mostrarAdminPanel()">
                    <i class="fas fa-users-cog"></i>
                    Administra√ß√£o
                </button>
                <button class="view-btn" onclick="mostrarDashboard()">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </button>
            </div>
        </header>

        <!-- PAINEL DE LOGIN -->
        <div id="loginPanel" class="login-panel">
            <div class="login-container">
                <div class="login-header">
                    <div class="logo">
                        <div class="logo-text">NexusCare</div>
                    </div>
                    <h2>NexusCare - Conectando o cuidado, ponto a ponto</h2>
                    <p>Sistema de Controle de Leitos - Pronto Atendimento</p>
                </div>
                
                <div class="login-form">
                    <h3>üîê Acesso ao Sistema</h3>
                    
                    <div class="form-group">
                        <label>üë§ Usu√°rio:</label>
                        <input type="text" id="loginUsuario" placeholder="Digite seu usu√°rio" class="login-input">
                    </div>
                    
                    <div class="form-group">
                        <label>üîë Senha:</label>
                        <input type="password" id="loginSenha" placeholder="Digite sua senha" class="login-input">
                    </div>
                    
                    <div class="form-group">
                        <label>üè• Setor:</label>
                        <select id="loginSetor" class="login-input">
                            <option value="">Selecione seu setor</option>
                            <option value="pa">Pronto Atendimento</option>
                            <option value="farmacia">Farm√°cia</option>
                            <option value="enfermagem">Enfermagem</option>
                            <option value="gerencia">Ger√™ncia</option>
                            <option value="direcao">Dire√ß√£o</option>
                        </select>
                    </div>
                    
                    <button onclick="fazerLogin()" class="btn-login">üöÄ Entrar no Sistema</button>
                    
                    <div style="text-align: center; margin: 10px 0;">
                        <a href="#" onclick="mostrarRecuperacaoSenha(); return false;" style="color: #3498db; text-decoration: none; font-size: 0.9rem;">üîë Esqueci minha senha</a>
                    </div>
                    
                    <div style="text-align: center; margin: 15px 0;">
                        <button onclick="mostrarCadastro()" class="btn-cadastro">üìù Cadastrar Novo Usu√°rio</button>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-- PAINEL DE CADASTRO -->
        <div id="cadastroPanel" class="login-panel" style="display: none;">
            <div class="login-container">
                <div class="login-header">
                    <div class="logo">
                        <div class="logo-text">NexusCare</div>
                    </div>
                    <h2>Cadastro de Novo Usu√°rio</h2>
                    <p>Sistema de Controle de Leitos - Pronto Atendimento</p>
                </div>
                
                <div class="login-form">
                    <h3>üìù Dados do Usu√°rio</h3>
                    
                    <div class="form-group">
                        <label>üë§ Nome Completo:</label>
                        <input type="text" id="cadastroNome" placeholder="Digite o nome completo" class="login-input">
                    </div>
                    
                    <div class="form-group">
                        <label>üîë Usu√°rio:</label>
                        <input type="text" id="cadastroUsuario" placeholder="Digite o nome de usu√°rio" class="login-input">
                    </div>
                    
                    <div class="form-group">
                        <label>üîí Senha:</label>
                        <input type="password" id="cadastroSenha" placeholder="Digite a senha" class="login-input">
                    </div>
                    
                    <div class="form-group">
                        <label>üîí Confirmar Senha:</label>
                        <input type="password" id="cadastroConfirmarSenha" placeholder="Confirme a senha" class="login-input">
                    </div>
                    
                    <div class="form-group">
                        <label>üè• Setor:</label>
                        <select id="cadastroSetor" class="login-input">
                            <option value="">Selecione o setor</option>
                            <option value="pa">Pronto Atendimento</option>
                            <option value="farmacia">Farm√°cia</option>
                            <option value="enfermagem">Enfermagem</option>
                            <option value="gerencia">Ger√™ncia</option>
                            <option value="direcao">Dire√ß√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>üîê Pergunta de Seguran√ßa:</label>
                        <select id="cadastroPerguntaSeguranca" class="login-input">
                            <option value="">Selecione uma pergunta</option>
                            <option value="nome_mae">Qual o nome da sua m√£e?</option>
                            <option value="cidade_nascimento">Em que cidade voc√™ nasceu?</option>
                            <option value="primeiro_pet">Qual o nome do seu primeiro animal de estima√ß√£o?</option>
                            <option value="escola_infancia">Qual o nome da sua escola na inf√¢ncia?</option>
                            <option value="cor_favorita">Qual sua cor favorita?</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>üí≠ Resposta de Seguran√ßa:</label>
                        <input type="text" id="cadastroRespostaSeguranca" placeholder="Digite sua resposta" class="login-input">
                    </div>
                    
                    <div class="form-group">
                        <label>üìß Email:</label>
                        <input type="email" id="cadastroEmail" placeholder="Digite o email" class="login-input">
                    </div>
                    
                    <button onclick="cadastrarUsuario()" class="btn-login">‚úÖ Cadastrar Usu√°rio</button>
                    
                    <div style="text-align: center; margin: 15px 0;">
                        <button onclick="voltarLogin()" class="btn-cadastro" style="background: #6c757d;">‚¨ÖÔ∏è Voltar ao Login</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE RECUPERA√á√ÉO DE SENHA -->
        <div id="modalRecuperacaoSenha" class="modal">
            <div class="modal-content">
                <span class="close" onclick="fecharModalRecuperacao()">&times;</span>
                <h3>üîë Recuperar Senha</h3>
                
                <div style="background: #e8f4fd; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem; color: #2c3e50;">
                    <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Para recuperar sua senha, responda √† pergunta de seguran√ßa que foi definida no seu cadastro.
                </div>
                
                <form id="formRecuperacao" onsubmit="processarRecuperacaoSenha(event)">
                    <div class="form-group">
                        <label for="usuarioRecuperacao" class="required-field">Usu√°rio:</label>
                        <input type="text" id="usuarioRecuperacao" name="usuarioRecuperacao" required placeholder="Digite seu nome de usu√°rio" oninput="verificarUsuarioExistente()">
                        <div id="statusUsuario" style="font-size: 0.8rem; margin-top: 2px;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="perguntaSeguranca" class="required-field">Pergunta de Seguran√ßa:</label>
                        <select id="perguntaSeguranca" name="perguntaSeguranca" required onchange="carregarPerguntaSeguranca()">
                            <option value="">Selecione uma pergunta</option>
                            <option value="nome_mae">Qual o nome da sua m√£e?</option>
                            <option value="cidade_nascimento">Em que cidade voc√™ nasceu?</option>
                            <option value="primeiro_pet">Qual o nome do seu primeiro animal de estima√ß√£o?</option>
                            <option value="escola_infancia">Qual o nome da sua escola na inf√¢ncia?</option>
                            <option value="cor_favorita">Qual sua cor favorita?</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="respostaSeguranca" class="required-field">Resposta:</label>
                        <input type="text" id="respostaSeguranca" name="respostaSeguranca" required placeholder="Digite sua resposta">
                    </div>
                    
                    <div id="novaSenhaGroup" style="display: none;">
                        <div class="form-group">
                            <label for="novaSenha" class="required-field">Nova Senha:</label>
                            <input type="password" id="novaSenha" name="novaSenha" placeholder="Digite sua nova senha">
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmarSenha" class="required-field">Confirmar Nova Senha:</label>
                            <input type="password" id="confirmarSenha" name="confirmarSenha" placeholder="Confirme sua nova senha">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-primary" id="btnRecuperacao">
                        <span style="margin-right: 8px;">üîç</span>
                        Verificar Resposta
                    </button>
                    
                    <div style="text-align: center; margin-top: 15px;">
                        <button type="button" onclick="fecharModalRecuperacao()" class="btn-cadastro" style="background: #6c757d;">
                            ‚¨ÖÔ∏è Voltar ao Login
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <main class="main-content" id="mainContent" style="display: none;">
            <!-- PAINEL PA -->
            <div id="paPanel" class="panel active">
                <h2><i class="fas fa-bed"></i> NexusCare - Controle de Leitos</h2>
                <div class="leitos-grid" id="leitosGrid">
                    <!-- LEITOS CRIADOS DIRETAMENTE NO HTML -->
                    <div class="leito-card" id="leito-PA-01">
                        <div class="leito-header">
                            <div class="leito-id">PA-01</div>
                            <div class="status-badge" id="status-PA-01">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-01">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-01')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-02">
                        <div class="leito-header">
                            <div class="leito-id">PA-02</div>
                            <div class="status-badge" id="status-PA-02">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-02">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-02')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-03">
                        <div class="leito-header">
                            <div class="leito-id">PA-03</div>
                            <div class="status-badge" id="status-PA-03">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-03">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-03')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-04">
                        <div class="leito-header">
                            <div class="leito-id">PA-04</div>
                            <div class="status-badge" id="status-PA-04">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-04">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-04')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-05">
                        <div class="leito-header">
                            <div class="leito-id">PA-05</div>
                            <div class="status-badge" id="status-PA-05">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-05">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-05')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-06">
                        <div class="leito-header">
                            <div class="leito-id">PA-06</div>
                            <div class="status-badge" id="status-PA-06">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-06">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-06')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-07">
                        <div class="leito-header">
                            <div class="leito-id">PA-07</div>
                            <div class="status-badge" id="status-PA-07">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-07">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-07')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-08">
                        <div class="leito-header">
                            <div class="leito-id">PA-08</div>
                            <div class="status-badge" id="status-PA-08">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-08">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-08')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-09">
                        <div class="leito-header">
                            <div class="leito-id">PA-09</div>
                            <div class="status-badge" id="status-PA-09">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-09">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-09')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-10">
                        <div class="leito-header">
                            <div class="leito-id">PA-10</div>
                            <div class="status-badge" id="status-PA-10">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-10">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-10')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-11">
                        <div class="leito-header">
                            <div class="leito-id">PA-11</div>
                            <div class="status-badge" id="status-PA-11">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-11">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-11')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-12">
                        <div class="leito-header">
                            <div class="leito-id">PA-12</div>
                            <div class="status-badge" id="status-PA-12">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-12">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-12')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-13">
                        <div class="leito-header">
                            <div class="leito-id">PA-13</div>
                            <div class="status-badge" id="status-PA-13">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-13">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-13')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-14">
                        <div class="leito-header">
                            <div class="leito-id">PA-14</div>
                            <div class="status-badge" id="status-PA-14">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-14">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-14')">Admitir Paciente</button>
                    </div>

                    <div class="leito-card" id="leito-PA-15">
                        <div class="leito-header">
                            <div class="leito-id">PA-15</div>
                            <div class="status-badge" id="status-PA-15">VAGO</div>
                        </div>
                        <div class="leito-info" id="info-PA-15">
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="info-value">Leito disponivel</span>
                            </div>
                        </div>
                        <button class="btn" onclick="abrirModal('PA-15')">Admitir Paciente</button>
                    </div>
                </div>
            </div>

            <!-- PAINEL FARMACIA -->
            <div id="farmaciaPanel" class="panel">
                <h2><i class="fas fa-pills"></i> NexusCare - Farm√°cia</h2>
                
                <!-- Estatisticas -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalAtivos">0</div>
                        <div class="stat-label">Pacientes Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalLeitos">0</div>
                        <div class="stat-label">Leitos Ocupados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="leitosDisponiveis">0</div>
                        <div class="stat-label">Leitos Disponiveis</div>
                    </div>
                </div>
                
                <!-- Filtros -->
                <div class="filters">
                    <input type="text" class="filter-input" id="filterFarmacia" placeholder="Filtrar por paciente...">
                    <button class="btn btn-primary" onclick="filtrarFarmacia()">Filtrar</button>
                    <button class="btn" onclick="limparFiltrosFarmacia()">Limpar</button>
                </div>
                
                <!-- Cards dos Pacientes -->
                <div class="farmacia-grid" id="farmaciaContent">
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;">
                        <i class="fas fa-user-injured" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p style="font-size: 1.1rem;">Nenhum paciente em atendimento no momento.</p>
                    </div>
                </div>
            </div>

            <!-- PAINEL RASTREABILIDADE -->
            <div id="rastreabilidadePanel" class="panel">
                <h2><i class="fas fa-search"></i> NexusCare - Rastreabilidade</h2>
                <div class="filters">
                    <input type="text" class="filter-input" id="filterPaciente" placeholder="Filtrar por paciente...">
                    <input type="text" class="filter-input" id="filterOrigem" placeholder="Filtrar por origem...">
                    <input type="date" class="filter-input" id="filterData">
                    <button class="btn btn-primary" onclick="filtrarRastreabilidade()">Filtrar</button>
                    <button class="btn" onclick="limparFiltrosRastreabilidade()">Limpar</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Paciente</th>
                                <th>Registro</th>
                                <th>Origem</th>
                                <th>Leito</th>
                                <th>Admissao PA</th>
                                <th>Saida PA</th>
                                <th>Destino</th>
                                <th>Status</th>
                                <th>Usu√°rio</th>
                                <th>Setor</th>
                            </tr>
                        </thead>
                        <tbody id="rastreabilidadeBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- PAINEL RELATORIOS -->
            <div id="relatoriosPanel" class="panel">
                <h2><i class="fas fa-chart-bar"></i> NexusCare - Relat√≥rios</h2>
                <div class="filters">
                    <input type="date" class="filter-input" id="dataInicio" placeholder="Data inicio">
                    <input type="date" class="filter-input" id="dataFim" placeholder="Data fim">
                    <select class="filter-input" id="tipoRelatorio">
                        <option value="tempo">Tempo de Permanencia</option>
                        <option value="geral">Relatorio Geral</option>
                        <option value="ocupacao">Ocupacao de Leitos</option>
                        <option value="origem">Por Origem</option>
                    </select>
                    <button class="btn btn-primary" onclick="gerarRelatorio()">Gerar Relatorio</button>
                    <button class="btn" onclick="exportarRelatorio()">Exportar CSV</button>
                </div>
                <div id="relatorioContent" class="table-container">
                    <p>Selecione os filtros e clique em "Gerar Relatorio"</p>
                </div>
            </div>
            
            <!-- PAINEL CONFIGURACAO DE EMAILS -->
            <div id="configEmailPanel" class="panel">
                <h2><i class="fas fa-envelope"></i> NexusCare - Configura√ß√£o de Emails</h2>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üîß Configura√ß√µes Gerais</h3>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <label style="font-weight: bold;">Sistema de Emails:</label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="emailAtivo" checked onchange="toggleEmailSistema()">
                            <span>Ativo</span>
                        </label>
                    </div>
                    <p style="color: #6c757d; font-size: 14px; margin: 0;">
                        Quando ativo, emails s√£o enviados automaticamente para notificar admiss√µes, transfer√™ncias e altas.
                    </p>
                </div>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üì¨ Destinat√°rios</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>üîî Emails de Admiss√£o:</h4>
                        <div id="emailsAdmissao" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
                            <input type="email" placeholder="farmacia@inmceb.com" class="email-input" value="farmacia@inmceb.com">
                            <input type="email" placeholder="enfermagem@inmceb.com" class="email-input" value="enfermagem@inmceb.com">
                        </div>
                        <button onclick="adicionarEmail('admissao')" class="btn-secondary" style="font-size: 12px;">+ Adicionar Email</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>üîÑ Emails de Transfer√™ncia:</h4>
                        <div id="emailsTransferencia" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
                            <input type="email" placeholder="farmacia@inmceb.com" class="email-input" value="farmacia@inmceb.com">
                            <input type="email" placeholder="enfermagem@inmceb.com" class="email-input" value="enfermagem@inmceb.com">
                        </div>
                        <button onclick="adicionarEmail('transferencia')" class="btn-secondary" style="font-size: 12px;">+ Adicionar Email</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>‚úÖ Emails de Alta:</h4>
                        <div id="emailsAlta" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
                            <input type="email" placeholder="farmacia@inmceb.com" class="email-input" value="farmacia@inmceb.com">
                            <input type="email" placeholder="enfermagem@inmceb.com" class="email-input" value="enfermagem@inmceb.com">
                        </div>
                        <button onclick="adicionarEmail('alta')" class="btn-secondary" style="font-size: 12px;">+ Adicionar Email</button>
                    </div>
                </div>
                
                <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>‚öôÔ∏è Configura√ß√µes de Envio Real</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>üìß M√©todo de Envio:</h4>
                        <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="metodoEnvio" value="mailto" checked onchange="alterarMetodoEnvio()">
                                <span>Cliente de Email (mailto)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="metodoEnvio" value="emailjs" onchange="alterarMetodoEnvio()">
                                <span>EmailJS (Envio Autom√°tico)</span>
                            </label>
                        </div>
                        <p style="color: #6c757d; font-size: 14px; margin: 0;">
                            <strong>Mailto:</strong> Abre seu cliente de email padr√£o<br>
                            <strong>EmailJS:</strong> Envia automaticamente (requer configura√ß√£o)
                        </p>
                    </div>
                    
                    <div id="configEmailJS" style="display: none; background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4>üîß Configura√ß√£o EmailJS (Envio Real):</h4>
                        
                        <div style="background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #ddd;">
                            <h5 style="margin: 0 0 10px 0; color: #2c3e50;">üìã Passo a Passo para Configurar:</h5>
                            <ol style="color: #6c757d; font-size: 14px; margin: 0; padding-left: 20px;">
                                <li>Acesse <a href="https://www.emailjs.com/" target="_blank" style="color: #007bff;">www.emailjs.com</a></li>
                                <li>Crie uma conta gratuita</li>
                                <li>Adicione seu servi√ßo de email (Gmail, Outlook, etc.)</li>
                                <li>Crie um template de email</li>
                                <li>Copie as credenciais abaixo</li>
                            </ol>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label><strong>Service ID:</strong></label>
                                <input type="text" id="emailjsServiceId" placeholder="service_xxxxxxx" class="filter-input">
                                <small style="color: #6c757d;">Ex: service_abc123</small>
                            </div>
                            <div>
                                <label><strong>Template ID:</strong></label>
                                <input type="text" id="emailjsTemplateId" placeholder="template_xxxxxxx" class="filter-input">
                                <small style="color: #6c757d;">Ex: template_xyz789</small>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label><strong>Public Key:</strong></label>
                            <input type="text" id="emailjsPublicKey" placeholder="sua_public_key_aqui" class="filter-input" style="width: 100%;">
                            <small style="color: #6c757d;">Chave p√∫blica do EmailJS</small>
                        </div>
                        
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <h6 style="margin: 0 0 5px 0; color: #856404;">‚ö†Ô∏è Importante:</h6>
                            <p style="margin: 0; color: #856404; font-size: 12px;">
                                O EmailJS √© gratuito at√© 200 emails/m√™s. Para uso profissional, considere planos pagos.
                            </p>
                        </div>
                        
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="testarConfigEmailJS()" class="btn-secondary">üß™ Testar Configura√ß√£o</button>
                            <button onclick="mostrarExemploTemplate()" class="btn-secondary">üìù Ver Template</button>
                            <button onclick="mostrarGuiaCompleto()" class="btn-primary">üìñ Guia Completo</button>
                        </div>
                    </div>
                    
                    <div id="configSMTP" style="display: none;">
                        <h4>‚öôÔ∏è Configura√ß√µes do Servidor SMTP:</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label>Servidor SMTP:</label>
                                <input type="text" id="smtpHost" value="smtp.gmail.com" class="filter-input">
                            </div>
                            <div>
                                <label>Porta:</label>
                                <input type="number" id="smtpPorta" value="587" class="filter-input">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label>Usu√°rio:</label>
                                <input type="email" id="smtpUsuario" value="sistema@inmceb.com" class="filter-input">
                            </div>
                            <div>
                                <label>Senha:</label>
                                <input type="password" id="smtpSenha" value="senha_do_sistema" class="filter-input">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <button onclick="salvarConfigEmail()" class="btn-primary">üíæ Salvar Configura√ß√µes</button>
                    <button onclick="testarEmail()" class="btn-secondary">üìß Testar Envio de Email</button>
                </div>
                
                <div id="statusConfigEmail" style="margin-top: 20px; padding: 15px; border-radius: 5px; display: none;"></div>
            </div>
            
            <!-- PAINEL CONFIGURACOES AVANCADAS -->
            <div id="configAvancadaPanel" class="panel">
                <h2><i class="fas fa-cogs"></i> NexusCare - Configura√ß√µes Avan√ßadas</h2>
                
                <!-- RELATORIOS AUTOMATICOS -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üìä Relat√≥rios Autom√°ticos</h3>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="relatoriosAutomaticos" checked onchange="toggleRelatoriosAutomaticos()">
                            <span>Ativar relat√≥rios autom√°ticos</span>
                        </label>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label>Frequ√™ncia:</label>
                            <select id="frequenciaRelatorios" class="filter-input">
                                <option value="diario">Di√°rio</option>
                                <option value="semanal">Semanal</option>
                                <option value="mensal">Mensal</option>
                            </select>
                        </div>
                        <div>
                            <label>Hor√°rio:</label>
                            <input type="time" id="horarioRelatorios" value="18:00" class="filter-input">
                        </div>
                        <div>
                            <label>Destinat√°rios:</label>
                            <input type="email" id="emailsRelatorios" placeholder="gerencia@inmceb.com" class="filter-input">
                        </div>
                    </div>
                    
                    <button onclick="testarRelatorioAutomatico()" class="btn-secondary">üìä Testar Relat√≥rio</button>
                </div>
                
                <!-- NOTIFICACOES PUSH -->
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üîî Notifica√ß√µes Push</h3>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="notificacoesPush" checked onchange="toggleNotificacoesPush()">
                            <span>Ativar notifica√ß√µes push</span>
                        </label>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label>Intervalo de verifica√ß√£o (segundos):</label>
                            <input type="number" id="intervaloPush" value="30" min="10" max="300" class="filter-input">
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button onclick="solicitarPermissaoPush()" class="btn-primary">üîî Solicitar Permiss√£o</button>
                        </div>
                    </div>
                    
                    <p style="color: #6c757d; font-size: 14px; margin: 0;">
                        As notifica√ß√µes push aparecer√£o mesmo quando a aba n√£o estiver ativa.
                    </p>
                </div>
                
                <!-- BACKUP AUTOMATICO -->
                <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üíæ Backup Autom√°tico</h3>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="backupAutomatico" checked onchange="toggleBackupAutomatico()">
                            <span>Ativar backup autom√°tico</span>
                        </label>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label>Frequ√™ncia:</label>
                            <select id="frequenciaBackup" class="filter-input">
                                <option value="hora">A cada hora</option>
                                <option value="diario">Di√°rio</option>
                            </select>
                        </div>
                        <div>
                            <label>Manter backups (dias):</label>
                            <input type="number" id="manterBackups" value="7" min="1" max="30" class="filter-input">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="fazerBackupManual()" class="btn-secondary">üíæ Backup Manual</button>
                        <button onclick="mostrarBackupsDisponiveis()" class="btn-secondary">üìã Ver Backups</button>
                    </div>
                </div>
                
                <!-- INTEGRACAO WHATSAPP -->
                <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üì± Integra√ß√£o WhatsApp</h3>
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="whatsappAtivo" onchange="toggleWhatsApp()">
                            <span>Ativar notifica√ß√µes WhatsApp</span>
                        </label>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label>N√∫mero WhatsApp (com DDD):</label>
                            <input type="tel" id="numeroWhatsApp" placeholder="11999999999" class="filter-input">
                        </div>
                        <div>
                            <label>API Key (WhatsApp Business):</label>
                            <input type="password" id="whatsappApiKey" placeholder="sua_api_key" class="filter-input">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="testarWhatsApp()" class="btn-secondary">üì± Testar WhatsApp</button>
                        <button onclick="mostrarGuiaWhatsApp()" class="btn-primary">üìñ Guia APIs WhatsApp</button>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <button onclick="salvarConfigAvancada()" class="btn-primary">üíæ Salvar Todas as Configura√ß√µes</button>
                </div>
                
                <div id="statusConfigAvancada" style="margin-top: 20px; padding: 15px; border-radius: 5px; display: none;"></div>
            </div>
            
            <!-- PAINEL ADMINISTRATIVO -->
            <div id="adminPanel" class="panel">
                <h2><i class="fas fa-users-cog"></i> NexusCare - Administra√ß√£o</h2>
                
                <!-- ESTATISTICAS -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üìä Estat√≠sticas do Sistema</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4 style="margin: 0; color: #1976d2;">üë• Total de Usu√°rios</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 5px 0; color: #1976d2;" id="totalUsuarios">0</p>
                        </div>
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4 style="margin: 0; color: #388e3c;">üü¢ Usu√°rios Ativos</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 5px 0; color: #388e3c;" id="usuariosAtivos">0</p>
                        </div>
                        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
                            <h4 style="margin: 0; color: #f57c00;">üîí Administradores</h4>
                            <p style="font-size: 24px; font-weight: bold; margin: 5px 0; color: #f57c00;" id="totalAdmins">0</p>
                        </div>
                    </div>
                </div>
                
                <!-- LISTA DE USUARIOS -->
                <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">üë• Gerenciar Usu√°rios</h3>
                        <button onclick="adicionarUsuario()" class="btn-primary">‚ûï Adicionar Usu√°rio</button>
                    </div>
                    
                    <div id="listaUsuarios" style="max-height: 400px; overflow-y: auto;">
                        <!-- Lista ser√° preenchida dinamicamente -->
                    </div>
                </div>
                
                <!-- CONFIGURACOES DE PERMISSOES -->
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3>üîß Configura√ß√µes de Permiss√µes</h3>
                    <p style="color: #6c757d; margin-bottom: 15px;">Configure as permiss√µes padr√£o para cada setor:</p>
                    
                    <div id="permissoesSetores">
                        <!-- Permiss√µes ser√£o preenchidas dinamicamente -->
                    </div>
                </div>
                
                <!-- BACKUP E RESTAURACAO -->
                <div style="background: #fff3e0; padding: 20px; border-radius: 10px;">
                    <h3>üíæ Backup e Restaura√ß√£o</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="exportarUsuarios()" class="btn-secondary">üì§ Exportar Usu√°rios</button>
                        <button onclick="importarUsuarios()" class="btn-secondary">üì• Importar Usu√°rios</button>
                        <button onclick="limparUsuarios()" class="btn-danger">üóëÔ∏è Limpar Todos os Usu√°rios</button>
                    </div>
                </div>
            </div>
            
            <!-- PAINEL DASHBOARD -->
            <div id="dashboardPanel" class="panel">
                <h2><i class="fas fa-tachometer-alt"></i> NexusCare - Dashboard</h2>
                
                <!-- FILTROS DE TEMPO -->
                <div class="dashboard-filters">
                    <div class="time-filter-container">
                        <h3>üìÖ Per√≠odo de An√°lise</h3>
                        <div class="time-buttons">
                            <button class="time-btn active" data-hours="12" onclick="filtrarPorTempo(12)">
                                <i class="fas fa-clock"></i> 12h
                            </button>
                            <button class="time-btn" data-hours="24" onclick="filtrarPorTempo(24)">
                                <i class="fas fa-calendar-day"></i> 24h
                            </button>
                            <button class="time-btn" data-hours="48" onclick="filtrarPorTempo(48)">
                                <i class="fas fa-calendar-alt"></i> 48h
                            </button>
                            <button class="time-btn" data-hours="168" onclick="filtrarPorTempo(168)">
                                <i class="fas fa-calendar-week"></i> 7 dias
                            </button>
                        </div>
                        <div class="custom-time">
                            <input type="datetime-local" id="dataInicioCustom" class="time-input">
                            <span>at√©</span>
                            <input type="datetime-local" id="dataFimCustom" class="time-input">
                            <button class="btn-custom" onclick="filtrarPorPeriodoCustom()">Aplicar</button>
                        </div>
                    </div>
                </div>
                
                <!-- CARDS DE ESTATISTICAS -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üè•</div>
                        <div class="stat-content">
                            <h3>Total de Leitos</h3>
                            <div class="stat-number" id="totalLeitos">15</div>
                            <div class="stat-change positive">+0%</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üü¢</div>
                        <div class="stat-content">
                            <h3>Leitos Ocupados</h3>
                            <div class="stat-number" id="leitosOcupados">0</div>
                            <div class="stat-change" id="ocupacaoChange">0%</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">‚ö´</div>
                        <div class="stat-content">
                            <h3>Leitos Dispon√≠veis</h3>
                            <div class="stat-number" id="leitosDisponiveis">15</div>
                            <div class="stat-change positive" id="disponivelChange">100%</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-content">
                            <h3>Admiss√µes</h3>
                            <div class="stat-number" id="totalAdmissoes">0</div>
                            <div class="stat-change" id="admissoesChange">+0</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-content">
                            <h3>Transfer√™ncias</h3>
                            <div class="stat-number" id="totalTransferencias">0</div>
                            <div class="stat-change" id="transferenciasChange">+0</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-content">
                            <h3>Altas</h3>
                            <div class="stat-number" id="totalAltas">0</div>
                            <div class="stat-change" id="altasChange">+0</div>
                        </div>
                    </div>
                </div>
                
                <!-- GRAFICOS E VISUALIZACOES -->
                <div class="dashboard-charts">
                    <div class="chart-container">
                        <h3>üìä Ocupa√ß√£o de Leitos</h3>
                        <div class="chart" id="ocupacaoChart">
                            <div class="chart-bars">
                                <!-- Barras ser√£o geradas dinamicamente -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>üìà Movimenta√ß√µes por Hora</h3>
                        <div class="chart" id="movimentacoesChart">
                            <div class="chart-line">
                                <!-- Linha ser√° gerada dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- TIMELINE DE EVENTOS -->
                <div class="dashboard-timeline">
                    <h3>üïí Timeline de Eventos</h3>
                    <div class="timeline-container" id="timelineContainer">
                        <!-- Eventos ser√£o gerados dinamicamente -->
                    </div>
                </div>
                
                <!-- ALERTAS E NOTIFICACOES -->
                <div class="dashboard-alerts">
                    <h3>üö® Alertas e Notifica√ß√µes</h3>
                    <div class="alerts-container" id="alertsContainer">
                        <!-- Alertas ser√£o gerados dinamicamente -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para Admitir Paciente -->
    <div id="modalAdmitir" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal()">&times;</span>
            <h3 id="modalTitulo">Admitir Paciente</h3>
            <div style="background: #e8f4fd; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem; color: #2c3e50;">
                <strong>‚ÑπÔ∏è Informa√ß√£o:</strong> Todos os campos marcados com <span style="color: #e74c3c;">*</span> s√£o obrigat√≥rios. O campo de observa√ß√µes √© opcional.
            </div>
            <form id="formAdmitir" onsubmit="salvarAdmissao(event)">
                <div class="form-group">
                    <label for="pacienteIniciais" class="required-field">Paciente (Iniciais):</label>
                    <input type="text" id="pacienteIniciais" name="pacienteIniciais" required oninput="this.value = this.value.toUpperCase()" placeholder="Ex: JOAO SILVA">
                </div>
                
                <div class="form-group">
                    <label for="registro" class="required-field">Registro:</label>
                    <input type="text" id="registro" name="registro" required placeholder="N√∫mero do registro do paciente">
                </div>
                
                <div class="form-group">
                    <label for="dataNascimento" class="required-field">Data de Nascimento:</label>
                    <input type="date" id="dataNascimento" name="dataNascimento" required>
                </div>
                
                <div class="form-group">
                    <label for="origem" class="required-field">Origem:</label>
                    <select id="origem" name="origem" required>
                        <option value="">Selecione a origem</option>
                        <option value="APARTAMENTOS">APARTAMENTOS</option>
                        <option value="MARIA VIEIRA">MARIA VIEIRA</option>
                        <option value="INFANTO">INFANTO</option>
                        <option value="GERALDO CARNEIRO">GERALDO CARNEIRO</option>
                        <option value="CANDIDA PEREIRA">CANDIDA PEREIRA</option>
                        <option value="BELMIRA AZEREDO">BELMIRA AZEREDO</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="observacoes">Observa√ß√µes:</label>
                    <textarea id="observacoes" name="observacoes" rows="5" maxlength="500" placeholder="Observa√ß√µes sobre o paciente... (opcional)" oninput="atualizarContadorObservacoes()"></textarea>
                    <div class="char-counter" id="contadorObservacoes">0/500 caracteres</div>
                </div>
                
                <button type="submit" class="btn-primary">
                    <span style="margin-right: 8px;">üíæ</span>
                    Salvar Admiss√£o
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para Transferir Paciente -->
    <div id="modalTransferir" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModalTransferir()">&times;</span>
            <h3 id="modalTituloTransferir">Transferir Paciente</h3>
            
            <!-- INFORMACOES DO PACIENTE -->
            <div class="paciente-info" id="pacienteInfo">
                <h4>Informacoes do Paciente:</h4>
                <p><strong>Nome:</strong> <span id="infoPacienteNome"></span></p>
                <p><strong>Registro:</strong> <span id="infoPacienteRegistro"></span></p>
                <p><strong>Origem:</strong> <span id="infoPacienteOrigem"></span></p>
                <p><strong>Leito:</strong> <span id="infoPacienteLeito"></span></p>
                <p><strong>Admissao:</strong> <span id="infoPacienteAdmissao"></span></p>
                <p><strong>Observacoes:</strong> <span id="infoPacienteObservacoes"></span></p>
            </div>
            
            <form id="formTransferir" onsubmit="salvarTransferencia(event)">
                <div class="form-group">
                    <label for="destino">Destino:</label>
                    <select id="destino" name="destino" required>
                        <option value="">Selecione o destino</option>
                        <option value="APARTAMENTOS">APARTAMENTOS</option>
                        <option value="MARIA VIEIRA">MARIA VIEIRA</option>
                        <option value="INFANTO">INFANTO</option>
                        <option value="GERALDO CARNEIRO">GERALDO CARNEIRO</option>
                        <option value="CANDIDA PEREIRA">CANDIDA PEREIRA</option>
                        <option value="BELMIRA AZEREDO">BELMIRA AZEREDO</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="observacoesTransferencia">Observacoes:</label>
                    <input type="text" id="observacoesTransferencia" name="observacoesTransferencia">
                </div>
                
                <button type="submit" class="btn-primary">Confirmar Transferencia</button>
            </form>
        </div>
    </div>

    <script>
        // VARIAVEIS GLOBAIS
        var leitoAtual = '';
        var dadosLeitos = {};
        var historicoPacientes = [];
        
        // CONFIGURACOES DE EMAIL
        var configEmail = {
            destinatarios: {
                admissao: ['farmacia@inmceb.com', 'enfermagem@inmceb.com'],
                transferencia: ['farmacia@inmceb.com', 'enfermagem@inmceb.com'],
                alta: ['farmacia@inmceb.com', 'enfermagem@inmceb.com'],
                relatorios: ['gerencia@inmceb.com', 'direcao@inmceb.com']
            },
            servidor: {
                host: 'smtp.gmail.com',
                porta: 587,
                usuario: 'sistema@inmceb.com',
                senha: 'senha_do_sistema'
            },
            ativo: true,
            emailjs: {
                publicKey: '',
                serviceId: 'service_inmceb',
                templateId: 'template_pa'
            },
            relatoriosAutomaticos: {
                ativo: true,
                frequencia: 'diario', // diario, semanal, mensal
                horario: '18:00',
                tipos: ['ocupacao', 'geral']
            }
        };
        
        // CONFIGURACOES DE NOTIFICACOES PUSH
        var configPush = {
            ativo: true,
            permissoes: false,
            intervalo: 30000 // 30 segundos
        };
        
        // CONFIGURACOES DE BACKUP
        var configBackup = {
            ativo: true,
            frequencia: 'hora', // hora, diario
            manterBackups: 7 // dias
        };
        
        // CONFIGURACOES DE WHATSAPP
        var configWhatsApp = {
            ativo: false,
            numero: '',
            apiKey: '',
            destinatarios: {
                admissao: [],
                transferencia: [],
                alta: []
            }
        };
        
        // SISTEMA DE USUARIOS E PERMISSOES
        var usuarios = {
            'pa': {
                senha: '123',
                nome: 'Equipe PA',
                setor: 'pa',
                perguntaSeguranca: 'nome_mae',
                respostaSeguranca: 'maria',
                permissoes: {
                    admitir: true,
                    transferir: true,
                    darAlta: true,
                    verFarmacia: true,
                    verRastreabilidade: true,
                    verRelatorios: true,
                    configurarEmails: false,
                    configurarAvancado: false
                }
            },
            'farmacia': {
                senha: '123',
                nome: 'Equipe Farm√°cia',
                setor: 'farmacia',
                perguntaSeguranca: 'cidade_nascimento',
                respostaSeguranca: 'sao paulo',
                permissoes: {
                    admitir: false,
                    transferir: false,
                    darAlta: false,
                    verFarmacia: true,
                    verRastreabilidade: true,
                    verRelatorios: true,
                    configurarEmails: false,
                    configurarAvancado: false
                }
            },
            'enfermagem': {
                senha: '123',
                nome: 'Equipe Enfermagem',
                setor: 'enfermagem',
                perguntaSeguranca: 'primeiro_pet',
                respostaSeguranca: 'rex',
                permissoes: {
                    admitir: true,
                    transferir: true,
                    darAlta: true,
                    verFarmacia: true,
                    verRastreabilidade: true,
                    verRelatorios: true,
                    configurarEmails: false,
                    configurarAvancado: false
                }
            },
            'gerencia': {
                senha: '123',
                nome: 'Ger√™ncia',
                setor: 'gerencia',
                perguntaSeguranca: 'escola_infancia',
                respostaSeguranca: 'santa maria',
                permissoes: {
                    admitir: true,
                    transferir: true,
                    darAlta: true,
                    verFarmacia: true,
                    verRastreabilidade: true,
                    verRelatorios: true,
                    configurarEmails: true,
                    configurarAvancado: true
                }
            },
            'direcao': {
                senha: '123',
                nome: 'Dire√ß√£o',
                setor: 'direcao',
                perguntaSeguranca: 'cor_favorita',
                respostaSeguranca: 'azul',
                permissoes: {
                    admitir: true,
                    transferir: true,
                    darAlta: true,
                    verFarmacia: true,
                    verRastreabilidade: true,
                    verRelatorios: true,
                    configurarEmails: true,
                    configurarAvancado: true
                }
            }
        };
        
        var usuarioLogado = null;
        
        // BANCO DE DADOS LOCAL DE USUARIOS
        var bancoUsuarios = {
            carregar: function() {
                var usuariosSalvos = localStorage.getItem('bancoUsuarios');
                if (usuariosSalvos) {
                    return JSON.parse(usuariosSalvos);
                }
                return {};
            },
            
            salvar: function(usuarios) {
                localStorage.setItem('bancoUsuarios', JSON.stringify(usuarios));
            },
            
            adicionar: function(usuario) {
                var usuarios = this.carregar();
                usuarios[usuario.usuario] = usuario;
                this.salvar(usuarios);
            },
            
            remover: function(usuario) {
                var usuarios = this.carregar();
                delete usuarios[usuario];
                this.salvar(usuarios);
            },
            
            atualizar: function(usuario, dados) {
                var usuarios = this.carregar();
                if (usuarios[usuario]) {
                    usuarios[usuario] = { ...usuarios[usuario], ...dados };
                    this.salvar(usuarios);
                }
            },
            
            buscar: function(usuario) {
                var usuarios = this.carregar();
                return usuarios[usuario] || null;
            },
            
            listar: function() {
                return this.carregar();
            }
        };
        
        // FUNCOES DE LOGIN E AUTENTICACAO
        function fazerLogin() {
            var usuario = document.getElementById('loginUsuario').value;
            var senha = document.getElementById('loginSenha').value;
            var setor = document.getElementById('loginSetor').value;
            
            if (!usuario || !senha || !setor) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            // Verificar credenciais (primeiro no banco, depois nos usu√°rios padr√£o)
            var usuarioEncontrado = bancoUsuarios.buscar(usuario) || usuarios[usuario];
            
            if (usuarioEncontrado && usuarioEncontrado.senha === senha && usuarioEncontrado.setor === setor) {
                usuarioLogado = usuarioEncontrado;
                usuarioLogado.usuario = usuario;
                
                // Salvar sess√£o
                localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                
                // Esconder login e mostrar sistema
                document.getElementById('loginPanel').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // Atualizar header com informa√ß√µes do usu√°rio
                atualizarHeaderUsuario();
                
                // Aplicar permiss√µes
                aplicarPermissoes();
                
                // Mostrar painel inicial baseado no setor
                mostrarPainelInicial();
                
                console.log('‚úÖ Login realizado:', usuarioLogado);
            } else {
                alert('Usu√°rio, senha ou setor incorretos.');
            }
        }
        
        function atualizarHeaderUsuario() {
            var headerContent = document.querySelector('.header-content');
            
            // Remover user-info existente se houver
            var userInfoExistente = document.querySelector('.user-info');
            if (userInfoExistente) {
                userInfoExistente.remove();
            }
            
            // Criar user-info
            var userInfo = document.createElement('div');
            userInfo.className = 'user-info';
            userInfo.innerHTML = `
                <div class="user-avatar">${usuarioLogado.nome.charAt(0)}</div>
                <div class="user-details">
                    <div class="user-name">${usuarioLogado.nome}</div>
                    <div class="user-role">${usuarioLogado.setor.toUpperCase()}</div>
                </div>
                <button onclick="fazerLogout()" class="logout-btn">Sair</button>
            `;
            
            headerContent.appendChild(userInfo);
        }
        
        function aplicarPermissoes() {
            var botoes = document.querySelectorAll('.view-btn');
            
            botoes.forEach(function(botao) {
                var onclick = botao.getAttribute('onclick');
                var temPermissao = false;
                
                // Verificar permiss√µes baseadas na fun√ß√£o
                if (onclick.includes('mostrarPA') || onclick.includes('mostrarFarmacia') || onclick.includes('mostrarRastreabilidade') || onclick.includes('mostrarRelatorios') || onclick.includes('mostrarDashboard')) {
                    temPermissao = true; // Todos podem ver estes pain√©is
                } else if (onclick.includes('mostrarConfigEmail')) {
                    temPermissao = usuarioLogado.permissoes.configurarEmails;
                } else if (onclick.includes('mostrarConfigAvancada')) {
                    temPermissao = usuarioLogado.permissoes.configurarAvancado;
                } else if (onclick.includes('mostrarAdminPanel')) {
                    temPermissao = usuarioLogado.permissoes.administrar;
                }
                
                if (temPermissao) {
                    botao.style.display = 'block';
                    botao.disabled = false;
                } else {
                    botao.style.display = 'none';
                }
            });
            
            // Aplicar permiss√µes nos leitos
            aplicarPermissoesLeitos();
        }
        
        function aplicarPermissoesLeitos() {
            var leitos = document.querySelectorAll('.leito-card');
            
            leitos.forEach(function(leito) {
                var botaoAdmitir = leito.querySelector('.btn-admitir');
                var botaoTransferir = leito.querySelector('.btn-transferir');
                var botaoAlta = leito.querySelector('.btn-alta');
                
                if (botaoAdmitir) {
                    botaoAdmitir.style.display = usuarioLogado.permissoes.admitir ? 'block' : 'none';
                }
                if (botaoTransferir) {
                    botaoTransferir.style.display = usuarioLogado.permissoes.transferir ? 'block' : 'none';
                }
                if (botaoAlta) {
                    botaoAlta.style.display = usuarioLogado.permissoes.darAlta ? 'block' : 'none';
                }
            });
        }
        
        function mostrarPainelInicial() {
            switch(usuarioLogado.setor) {
                case 'pa':
                case 'enfermagem':
                    switchPanel('paPanel');
                    break;
                case 'farmacia':
                    switchPanel('farmaciaPanel');
                    renderizarFarmacia();
                    break;
                case 'gerencia':
                case 'direcao':
                    switchPanel('relatoriosPanel');
                    break;
                default:
                    switchPanel('paPanel');
            }
        }
        
        function fazerLogout() {
            if (confirm('Deseja realmente sair do sistema?')) {
                usuarioLogado = null;
                localStorage.removeItem('usuarioLogado');
                
                // Mostrar login e esconder sistema
                document.getElementById('loginPanel').style.display = 'flex';
                document.getElementById('mainContent').style.display = 'none';
                
                // Limpar campos de login
                document.getElementById('loginUsuario').value = '';
                document.getElementById('loginSenha').value = '';
                document.getElementById('loginSetor').value = '';
                
                console.log('üëã Logout realizado');
            }
        }
        
        function verificarSessao() {
            var sessaoSalva = localStorage.getItem('usuarioLogado');
            if (sessaoSalva) {
                usuarioLogado = JSON.parse(sessaoSalva);
                document.getElementById('loginPanel').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                atualizarHeaderUsuario();
                aplicarPermissoes();
                mostrarPainelInicial();
                console.log('üîÑ Sess√£o restaurada:', usuarioLogado);
            }
        }
        
        // FUNCOES DE CADASTRO
        function mostrarCadastro() {
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('cadastroPanel').style.display = 'flex';
        }
        
        function voltarLogin() {
            document.getElementById('cadastroPanel').style.display = 'none';
            document.getElementById('loginPanel').style.display = 'flex';
        }
        
        // FUNCOES DE RECUPERACAO DE SENHA
        function mostrarRecuperacaoSenha() {
            document.getElementById('loginPanel').style.display = 'none';
            document.getElementById('modalRecuperacaoSenha').style.display = 'block';
            document.getElementById('formRecuperacao').reset();
            document.getElementById('novaSenhaGroup').style.display = 'none';
            document.getElementById('btnRecuperacao').innerHTML = '<span style="margin-right: 8px;">üîç</span>Verificar Resposta';
        }
        
        function fecharModalRecuperacao() {
            document.getElementById('modalRecuperacaoSenha').style.display = 'none';
            document.getElementById('loginPanel').style.display = 'flex';
        }
        
        function verificarUsuarioExistente() {
            var usuario = document.getElementById('usuarioRecuperacao').value;
            var statusDiv = document.getElementById('statusUsuario');
            
            if (usuario.length < 2) {
                statusDiv.innerHTML = '';
                return;
            }
            
            // Verificar se o usu√°rio existe
            var usuarioEncontrado = null;
            
            // Verificar usu√°rios padr√£o
            if (usuarios[usuario]) {
                usuarioEncontrado = usuarios[usuario];
            }
            
            // Verificar usu√°rios cadastrados
            if (!usuarioEncontrado && bancoUsuarios[usuario]) {
                usuarioEncontrado = bancoUsuarios[usuario];
            }
            
            if (usuarioEncontrado) {
                statusDiv.innerHTML = '<span style="color: #27ae60;">‚úÖ Usu√°rio encontrado</span>';
                if (usuarioEncontrado.perguntaSeguranca) {
                    statusDiv.innerHTML += '<br><span style="color: #3498db;">üîê Pergunta de seguran√ßa configurada</span>';
                } else {
                    statusDiv.innerHTML += '<br><span style="color: #f39c12;">‚ö†Ô∏è Pergunta de seguran√ßa n√£o configurada</span>';
                }
            } else {
                statusDiv.innerHTML = '<span style="color: #e74c3c;">‚ùå Usu√°rio n√£o encontrado</span>';
            }
        }
        
        function carregarPerguntaSeguranca() {
            var usuario = document.getElementById('usuarioRecuperacao').value;
            var pergunta = document.getElementById('perguntaSeguranca').value;
            
            if (usuario && pergunta) {
                // Verificar se o usu√°rio existe
                var usuarioEncontrado = null;
                
                // Verificar usu√°rios padr√£o
                if (usuarios[usuario]) {
                    usuarioEncontrado = usuarios[usuario];
                }
                
                // Verificar usu√°rios cadastrados
                if (!usuarioEncontrado && bancoUsuarios[usuario]) {
                    usuarioEncontrado = bancoUsuarios[usuario];
                }
                
                if (usuarioEncontrado) {
                    // Usu√°rio encontrado - permitir qualquer pergunta
                    document.getElementById('respostaSeguranca').placeholder = 'Digite sua resposta para: ' + document.getElementById('perguntaSeguranca').selectedOptions[0].text;
                } else {
                    alert('Usu√°rio "' + usuario + '" n√£o encontrado. Verifique se o nome de usu√°rio est√° correto.');
                    document.getElementById('perguntaSeguranca').value = '';
                }
            }
        }
        
        function processarRecuperacaoSenha(event) {
            event.preventDefault();
            
            var usuario = document.getElementById('usuarioRecuperacao').value;
            var pergunta = document.getElementById('perguntaSeguranca').value;
            var resposta = document.getElementById('respostaSeguranca').value;
            var novaSenha = document.getElementById('novaSenha').value;
            var confirmarSenha = document.getElementById('confirmarSenha').value;
            
            // Verificar se √© a primeira etapa (verificar resposta)
            if (document.getElementById('novaSenhaGroup').style.display === 'none') {
                if (!usuario || !pergunta || !resposta) {
                    alert('Por favor, preencha todos os campos.');
                    return;
                }
                
                // Verificar usu√°rio e resposta
                var usuarioEncontrado = null;
                
                // Verificar usu√°rios padr√£o
                if (usuarios[usuario]) {
                    usuarioEncontrado = usuarios[usuario];
                }
                
                // Verificar usu√°rios cadastrados
                if (!usuarioEncontrado && bancoUsuarios[usuario]) {
                    usuarioEncontrado = bancoUsuarios[usuario];
                }
                
                if (!usuarioEncontrado) {
                    alert('Usu√°rio n√£o encontrado.');
                    return;
                }
                
                // Verificar se o usu√°rio tem pergunta de seguran√ßa configurada
                if (usuarioEncontrado.perguntaSeguranca && usuarioEncontrado.respostaSeguranca) {
                    // Usu√°rio tem pergunta configurada - verificar se √© a mesma
                    if (usuarioEncontrado.perguntaSeguranca !== pergunta) {
                        alert('Esta n√£o √© a pergunta de seguran√ßa configurada para este usu√°rio. Selecione a pergunta correta.');
                        return;
                    }
                    
                    if (usuarioEncontrado.respostaSeguranca.toLowerCase() === resposta.toLowerCase()) {
                        // Resposta correta - mostrar campos de nova senha
                        document.getElementById('novaSenhaGroup').style.display = 'block';
                        document.getElementById('btnRecuperacao').innerHTML = '<span style="margin-right: 8px;">üíæ</span>Alterar Senha';
                        alert('Resposta correta! Agora defina sua nova senha.');
                    } else {
                        alert('Resposta incorreta. Tente novamente.');
                    }
                } else {
                    // Usu√°rio n√£o tem pergunta configurada - permitir configurar agora
                    if (confirm('Este usu√°rio n√£o possui pergunta de seguran√ßa configurada. Deseja configurar uma agora e alterar a senha?')) {
                        // Salvar a pergunta e resposta
                        usuarioEncontrado.perguntaSeguranca = pergunta;
                        usuarioEncontrado.respostaSeguranca = resposta.toLowerCase();
                        
                        // Salvar no localStorage se for usu√°rio cadastrado
                        if (bancoUsuarios[usuario]) {
                            localStorage.setItem('bancoUsuarios', JSON.stringify(bancoUsuarios));
                        }
                        
                        // Mostrar campos de nova senha
                        document.getElementById('novaSenhaGroup').style.display = 'block';
                        document.getElementById('btnRecuperacao').innerHTML = '<span style="margin-right: 8px;">üíæ</span>Alterar Senha';
                        alert('Pergunta de seguran√ßa configurada! Agora defina sua nova senha.');
                    }
                }
            } else {
                // Segunda etapa - alterar senha
                if (!novaSenha || !confirmarSenha) {
                    alert('Por favor, preencha todos os campos da nova senha.');
                    return;
                }
                
                if (novaSenha !== confirmarSenha) {
                    alert('As senhas n√£o coincidem.');
                    return;
                }
                
                if (novaSenha.length < 4) {
                    alert('A senha deve ter pelo menos 4 caracteres.');
                    return;
                }
                
                // Atualizar senha
                var usuarioEncontrado = null;
                
                if (usuarios[usuario]) {
                    usuarios[usuario].senha = novaSenha;
                    usuarioEncontrado = usuarios[usuario];
                }
                
                if (bancoUsuarios[usuario]) {
                    bancoUsuarios[usuario].senha = novaSenha;
                    usuarioEncontrado = bancoUsuarios[usuario];
                }
                
                // Salvar no localStorage
                localStorage.setItem('bancoUsuarios', JSON.stringify(bancoUsuarios));
                
                alert('Senha alterada com sucesso! Agora voc√™ pode fazer login com sua nova senha.');
                fecharModalRecuperacao();
            }
        }
        
        function cadastrarUsuario() {
            var nome = document.getElementById('cadastroNome').value;
            var usuario = document.getElementById('cadastroUsuario').value;
            var senha = document.getElementById('cadastroSenha').value;
            var confirmarSenha = document.getElementById('cadastroConfirmarSenha').value;
            var setor = document.getElementById('cadastroSetor').value;
            var perguntaSeguranca = document.getElementById('cadastroPerguntaSeguranca').value;
            var respostaSeguranca = document.getElementById('cadastroRespostaSeguranca').value;
            var email = document.getElementById('cadastroEmail').value;
            
            // Valida√ß√µes
            if (!nome || !usuario || !senha || !confirmarSenha || !setor || !perguntaSeguranca || !respostaSeguranca || !email) {
                alert('Por favor, preencha todos os campos, incluindo a pergunta de seguran√ßa.');
                return;
            }
            
            if (senha !== confirmarSenha) {
                alert('As senhas n√£o coincidem.');
                return;
            }
            
            if (senha.length < 3) {
                alert('A senha deve ter pelo menos 3 caracteres.');
                return;
            }
            
            // Verificar se usu√°rio j√° existe
            if (bancoUsuarios.buscar(usuario) || usuarios[usuario]) {
                alert('Este nome de usu√°rio j√° existe. Escolha outro.');
                return;
            }
            
            // Criar novo usu√°rio
            var novoUsuario = {
                nome: nome,
                usuario: usuario,
                senha: senha,
                setor: setor,
                email: email,
                perguntaSeguranca: perguntaSeguranca,
                respostaSeguranca: respostaSeguranca.toLowerCase(),
                ativo: true,
                dataCriacao: new Date().toISOString(),
                permissoes: gerarPermissoesPorSetor(setor)
            };
            
            // Salvar no banco
            bancoUsuarios.adicionar(novoUsuario);
            
            // Limpar formul√°rio
            document.getElementById('cadastroNome').value = '';
            document.getElementById('cadastroUsuario').value = '';
            document.getElementById('cadastroSenha').value = '';
            document.getElementById('cadastroConfirmarSenha').value = '';
            document.getElementById('cadastroSetor').value = '';
            document.getElementById('cadastroPerguntaSeguranca').value = '';
            document.getElementById('cadastroRespostaSeguranca').value = '';
            document.getElementById('cadastroEmail').value = '';
            
            alert('Usu√°rio cadastrado com sucesso!');
            voltarLogin();
        }
        
        function gerarPermissoesPorSetor(setor) {
            var permissoesPadrao = {
                admitir: false,
                transferir: false,
                darAlta: false,
                verFarmacia: true,
                verRastreabilidade: true,
                verRelatorios: true,
                configurarEmails: false,
                configurarAvancado: false,
                administrar: false
            };
            
            switch(setor) {
                case 'pa':
                case 'enfermagem':
                    permissoesPadrao.admitir = true;
                    permissoesPadrao.transferir = true;
                    permissoesPadrao.darAlta = true;
                    break;
                case 'gerencia':
                case 'direcao':
                    permissoesPadrao.admitir = true;
                    permissoesPadrao.transferir = true;
                    permissoesPadrao.darAlta = true;
                    permissoesPadrao.configurarEmails = true;
                    permissoesPadrao.configurarAvancado = true;
                    permissoesPadrao.administrar = true;
                    break;
            }
            
            return permissoesPadrao;
        }
        
        // FUNCOES DE ADMINISTRACAO
        function mostrarAdminPanel() {
            // Verificar permiss√£o
            if (!usuarioLogado || !usuarioLogado.permissoes.administrar) {
                alert('Voc√™ n√£o tem permiss√£o para acessar a administra√ß√£o.');
                return;
            }
            
            switchPanel('adminPanel');
            carregarDadosAdmin();
        }
        
        function carregarDadosAdmin() {
            var todosUsuarios = { ...usuarios, ...bancoUsuarios.listar() };
            var totalUsuarios = Object.keys(todosUsuarios).length;
            var usuariosAtivos = Object.values(todosUsuarios).filter(u => u.ativo !== false).length;
            var totalAdmins = Object.values(todosUsuarios).filter(u => u.permissoes && u.permissoes.administrar).length;
            
            document.getElementById('totalUsuarios').textContent = totalUsuarios;
            document.getElementById('usuariosAtivos').textContent = usuariosAtivos;
            document.getElementById('totalAdmins').textContent = totalAdmins;
            
            renderizarListaUsuarios();
            renderizarPermissoesSetores();
        }
        
        function renderizarListaUsuarios() {
            var todosUsuarios = { ...usuarios, ...bancoUsuarios.listar() };
            var listaUsuarios = document.getElementById('listaUsuarios');
            
            listaUsuarios.innerHTML = '';
            
            Object.keys(todosUsuarios).forEach(function(usuario) {
                var dados = todosUsuarios[usuario];
                var card = document.createElement('div');
                card.style.cssText = `
                    background: #f8f9fa;
                    border: 1px solid #dee2e6;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 10px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                `;
                
                var isAdmin = dados.permissoes && dados.permissoes.administrar;
                var isPadrao = usuarios[usuario] ? true : false;
                
                card.innerHTML = `
                    <div>
                        <h4 style="margin: 0; color: #2c3e50;">${dados.nome || usuario}</h4>
                        <p style="margin: 5px 0; color: #6c757d; font-size: 14px;">
                            <strong>Usu√°rio:</strong> ${usuario} | 
                            <strong>Setor:</strong> ${dados.setor.toUpperCase()} |
                            <strong>Email:</strong> ${dados.email || 'N/A'}
                            ${isAdmin ? ' | <span style="color: #f57c00;">üîí ADMIN</span>' : ''}
                            ${isPadrao ? ' | <span style="color: #6c757d;">(Padr√£o)</span>' : ''}
                        </p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="editarUsuario('${usuario}')" class="btn-secondary" style="font-size: 12px;">‚úèÔ∏è Editar</button>
                        ${!isPadrao ? `<button onclick="removerUsuario('${usuario}')" class="btn-danger" style="font-size: 12px;">üóëÔ∏è Remover</button>` : ''}
                    </div>
                `;
                
                listaUsuarios.appendChild(card);
            });
        }
        
        function renderizarPermissoesSetores() {
            var permissoesSetores = document.getElementById('permissoesSetores');
            var setores = ['pa', 'farmacia', 'enfermagem', 'gerencia', 'direcao'];
            
            permissoesSetores.innerHTML = '';
            
            setores.forEach(function(setor) {
                var permissoes = gerarPermissoesPorSetor(setor);
                var card = document.createElement('div');
                card.style.cssText = `
                    background: white;
                    border: 1px solid #dee2e6;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 10px;
                `;
                
                card.innerHTML = `
                    <h4 style="margin: 0 0 10px 0; color: #2c3e50;">${setor.toUpperCase()}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                        ${Object.keys(permissoes).map(function(permissao) {
                            return `
                                <label style="display: flex; align-items: center; gap: 5px; font-size: 12px;">
                                    <input type="checkbox" ${permissoes[permissao] ? 'checked' : ''} 
                                           onchange="atualizarPermissaoSetor('${setor}', '${permissao}', this.checked)">
                                    <span>${permissao.replace(/([A-Z])/g, ' $1').toLowerCase()}</span>
                                </label>
                            `;
                        }).join('')}
                    </div>
                `;
                
                permissoesSetores.appendChild(card);
            });
        }
        
        function adicionarUsuario() {
            mostrarCadastro();
        }
        
        function editarUsuario(usuario) {
            // Implementar edi√ß√£o de usu√°rio
            alert('Funcionalidade de edi√ß√£o ser√° implementada em breve.');
        }
        
        function removerUsuario(usuario) {
            if (confirm('Tem certeza que deseja remover este usu√°rio?')) {
                bancoUsuarios.remover(usuario);
                carregarDadosAdmin();
                alert('Usu√°rio removido com sucesso!');
            }
        }
        
        function atualizarPermissaoSetor(setor, permissao, valor) {
            // Atualizar permiss√µes padr√£o para o setor
            console.log(`Atualizando permiss√£o ${permissao} para ${setor}: ${valor}`);
            // Implementar l√≥gica de atualiza√ß√£o
        }
        
        function exportarUsuarios() {
            var usuarios = bancoUsuarios.listar();
            var dataStr = JSON.stringify(usuarios, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            var url = URL.createObjectURL(dataBlob);
            var link = document.createElement('a');
            link.href = url;
            link.download = 'usuarios_inmceb.json';
            link.click();
        }
        
        function importarUsuarios() {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                var file = e.target.files[0];
                var reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        var usuariosImportados = JSON.parse(e.target.result);
                        // Mesclar com usu√°rios existentes
                        var usuariosAtuais = bancoUsuarios.listar();
                        var usuariosFinais = { ...usuariosAtuais, ...usuariosImportados };
                        bancoUsuarios.salvar(usuariosFinais);
                        carregarDadosAdmin();
                        alert('Usu√°rios importados com sucesso!');
                    } catch (error) {
                        alert('Erro ao importar arquivo. Verifique se √© um JSON v√°lido.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function limparUsuarios() {
            if (confirm('ATEN√á√ÉO: Isso remover√° TODOS os usu√°rios cadastrados (exceto os padr√£o). Tem certeza?')) {
                bancoUsuarios.salvar({});
                carregarDadosAdmin();
                alert('Todos os usu√°rios foram removidos!');
            }
        }
        
        // FUNCOES DO DASHBOARD
        var dashboardData = {
            periodoAtual: 12, // horas
            dados: {
                leitos: [],
                movimentacoes: [],
                alertas: []
            }
        };
        
        function mostrarDashboard() {
            switchPanel('dashboardPanel');
            carregarDashboard();
        }
        
        function carregarDashboard() {
            atualizarEstatisticas();
            gerarGraficoOcupacao();
            gerarGraficoMovimentacoes();
            carregarTimeline();
            carregarAlertas();
        }
        
        function filtrarPorTempo(horas) {
            // Atualizar bot√µes ativos
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-hours="${horas}"]`).classList.add('active');
            
            dashboardData.periodoAtual = horas;
            carregarDashboard();
        }
        
        function filtrarPorPeriodoCustom() {
            var dataInicio = document.getElementById('dataInicioCustom').value;
            var dataFim = document.getElementById('dataFimCustom').value;
            
            if (!dataInicio || !dataFim) {
                alert('Por favor, selecione as datas de in√≠cio e fim.');
                return;
            }
            
            // Calcular diferen√ßa em horas
            var inicio = new Date(dataInicio);
            var fim = new Date(dataFim);
            var diffHoras = (fim - inicio) / (1000 * 60 * 60);
            
            dashboardData.periodoAtual = diffHoras;
            carregarDashboard();
        }
        
        function atualizarEstatisticas() {
            var agora = new Date();
            var inicioPeriodo = new Date(agora.getTime() - (dashboardData.periodoAtual * 60 * 60 * 1000));
            
            // Contar leitos
            var totalLeitos = 15;
            var leitosOcupados = 0;
            
            for (var i = 1; i <= 15; i++) {
                var leitoId = 'PA-' + (i < 10 ? '0' + i : i);
                var status = document.getElementById('status-' + leitoId);
                if (status && status.textContent === 'EM ATENDIMENTO') {
                    leitosOcupados++;
                }
            }
            
            // Calcular leitos dispon√≠veis corretamente
            var leitosDisponiveis = totalLeitos - leitosOcupados;
            
            // Contar movimenta√ß√µes no per√≠odo
            var admissoes = 0;
            var transferencias = 0;
            var altas = 0;
            
            historicoPacientes.forEach(function(evento) {
                var dataEvento = new Date(evento.dataHora);
                if (dataEvento >= inicioPeriodo) {
                    if (evento.tipo === 'admissao') admissoes++;
                    else if (evento.tipo === 'transferencia') transferencias++;
                    else if (evento.tipo === 'alta') altas++;
                }
            });
            
            // Atualizar cards
            document.getElementById('totalLeitos').textContent = totalLeitos;
            document.getElementById('leitosOcupados').textContent = leitosOcupados;
            document.getElementById('leitosDisponiveis').textContent = leitosDisponiveis;
            document.getElementById('totalAdmissoes').textContent = admissoes;
            document.getElementById('totalTransferencias').textContent = transferencias;
            document.getElementById('totalAltas').textContent = altas;
            
            // Atualizar percentuais
            var percentualOcupacao = totalLeitos > 0 ? Math.round((leitosOcupados / totalLeitos) * 100) : 0;
            var percentualDisponivel = totalLeitos > 0 ? Math.round((leitosDisponiveis / totalLeitos) * 100) : 0;
            
            document.getElementById('ocupacaoChange').textContent = percentualOcupacao + '%';
            document.getElementById('ocupacaoChange').className = 'stat-change ' + (percentualOcupacao > 80 ? 'negative' : 'positive');
            
            // Atualizar percentual de disponibilidade
            document.getElementById('disponivelChange').textContent = percentualDisponivel + '%';
            document.getElementById('disponivelChange').className = 'stat-change ' + (percentualDisponivel > 50 ? 'positive' : 'negative');
            
            document.getElementById('admissoesChange').textContent = '+' + admissoes;
            document.getElementById('transferenciasChange').textContent = '+' + transferencias;
            document.getElementById('altasChange').textContent = '+' + altas;
        }
        
        function gerarGraficoOcupacao() {
            var chartBars = document.querySelector('#ocupacaoChart .chart-bars');
            chartBars.innerHTML = '';
            
            // Contar leitos ocupados primeiro
            var leitosOcupados = 0;
            for (var i = 1; i <= 15; i++) {
                var leitoId = 'PA-' + (i < 10 ? '0' + i : i);
                var status = document.getElementById('status-' + leitoId);
                if (status && status.textContent === 'EM ATENDIMENTO') {
                    leitosOcupados++;
                }
            }
            
            // Gerar barras para cada leito
            for (var i = 1; i <= 15; i++) {
                var leitoId = 'PA-' + (i < 10 ? '0' + i : i);
                var status = document.getElementById('status-' + leitoId);
                var isOcupado = status && status.textContent === 'EM ATENDIMENTO';
                var altura = isOcupado ? 80 : 20;
                
                var bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = altura + '%';
                bar.style.background = isOcupado ? 
                    'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)' : 
                    'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)';
                bar.title = leitoId + ': ' + (status ? status.textContent : 'VAGO');
                chartBars.appendChild(bar);
            }
        }
        
        function gerarGraficoMovimentacoes() {
            var chartLine = document.querySelector('#movimentacoesChart .chart-line');
            chartLine.innerHTML = '';
            
            // Gerar dados das √∫ltimas 24 horas
            var agora = new Date();
            var dados = [];
            
            for (var i = 23; i >= 0; i--) {
                var hora = new Date(agora.getTime() - (i * 60 * 60 * 1000));
                var movimentacoes = 0;
                
                historicoPacientes.forEach(function(evento) {
                    var dataEvento = new Date(evento.dataHora);
                    if (dataEvento.getHours() === hora.getHours() && 
                        dataEvento.getDate() === hora.getDate()) {
                        movimentacoes++;
                    }
                });
                
                dados.push(movimentacoes);
            }
            
            // Criar linha do gr√°fico
            var maxMov = Math.max(...dados, 1);
            var pontos = dados.map((valor, index) => {
                var x = (index / (dados.length - 1)) * 100;
                var y = 100 - (valor / maxMov) * 80;
                return x + ',' + y;
            }).join(' ');
            
            var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            
            var polyline = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
            polyline.setAttribute('points', pontos);
            polyline.setAttribute('fill', 'none');
            polyline.setAttribute('stroke', '#667eea');
            polyline.setAttribute('stroke-width', '3');
            polyline.setAttribute('stroke-linecap', 'round');
            polyline.setAttribute('stroke-linejoin', 'round');
            
            svg.appendChild(polyline);
            chartLine.appendChild(svg);
        }
        
        function carregarTimeline() {
            var timelineContainer = document.getElementById('timelineContainer');
            timelineContainer.innerHTML = '';
            
            var agora = new Date();
            var inicioPeriodo = new Date(agora.getTime() - (dashboardData.periodoAtual * 60 * 60 * 1000));
            
            // Filtrar eventos do per√≠odo
            var eventosPeriodo = historicoPacientes.filter(function(evento) {
                return new Date(evento.dataHora) >= inicioPeriodo;
            });
            
            // Ordenar por data (mais recente primeiro)
            eventosPeriodo.sort(function(a, b) {
                return new Date(b.dataHora) - new Date(a.dataHora);
            });
            
            // Limitar a 20 eventos mais recentes
            eventosPeriodo = eventosPeriodo.slice(0, 20);
            
            eventosPeriodo.forEach(function(evento) {
                var item = document.createElement('div');
                item.className = 'timeline-item';
                
                var icon = document.createElement('div');
                icon.className = 'timeline-icon ' + evento.tipo;
                
                var content = document.createElement('div');
                content.className = 'timeline-content';
                
                var title = document.createElement('div');
                title.className = 'timeline-title';
                
                var time = document.createElement('div');
                time.className = 'timeline-time';
                
                // Configurar baseado no tipo
                switch(evento.tipo) {
                    case 'admissao':
                        icon.textContent = 'üì•';
                        title.textContent = 'Paciente ' + evento.paciente + ' admitido no ' + evento.leito;
                        break;
                    case 'transferencia':
                        icon.textContent = 'üîÑ';
                        title.textContent = 'Paciente ' + evento.paciente + ' transferido para ' + evento.destino;
                        break;
                    case 'alta':
                        icon.textContent = '‚úÖ';
                        title.textContent = 'Paciente ' + evento.paciente + ' recebeu alta';
                        break;
                }
                
                time.textContent = new Date(evento.dataHora).toLocaleString('pt-BR');
                
                content.appendChild(title);
                content.appendChild(time);
                item.appendChild(icon);
                item.appendChild(content);
                timelineContainer.appendChild(item);
            });
            
            if (eventosPeriodo.length === 0) {
                timelineContainer.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">Nenhum evento no per√≠odo selecionado</div>';
            }
        }
        
        function carregarAlertas() {
            var alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';
            
            var alertas = [];
            
            // Verificar ocupa√ß√£o alta
            var leitosOcupados = 0;
            for (var i = 1; i <= 15; i++) {
                var leitoId = 'PA-' + (i < 10 ? '0' + i : i);
                var status = document.getElementById('status-' + leitoId);
                if (status && status.textContent === 'EM ATENDIMENTO') {
                    leitosOcupados++;
                }
            }
            
            var percentualOcupacao = Math.round((leitosOcupados / 15) * 100);
            var leitosDisponiveis = 15 - leitosOcupados;
            
            if (percentualOcupacao > 80) {
                alertas.push({
                    tipo: 'warning',
                    titulo: 'Alta Ocupa√ß√£o',
                    mensagem: 'Taxa de ocupa√ß√£o em ' + percentualOcupacao + '% (' + leitosOcupados + '/15) - Considere preparar leitos adicionais'
                });
            } else if (percentualOcupacao > 60) {
                alertas.push({
                    tipo: 'info',
                    titulo: 'Ocupa√ß√£o Moderada',
                    mensagem: 'Taxa de ocupa√ß√£o em ' + percentualOcupacao + '% (' + leitosOcupados + '/15) - Sistema operando normalmente'
                });
            }
            
            // Verificar se todos os leitos est√£o vazios
            if (leitosOcupados === 0) {
                alertas.push({
                    tipo: 'success',
                    titulo: 'Sistema Dispon√≠vel',
                    mensagem: 'Todos os 15 leitos est√£o dispon√≠veis - Sistema operando normalmente'
                });
            }
            
            // Verificar se h√° poucos leitos dispon√≠veis
            if (leitosDisponiveis <= 3 && leitosOcupados > 0) {
                alertas.push({
                    tipo: 'warning',
                    titulo: 'Poucos Leitos Dispon√≠veis',
                    mensagem: 'Apenas ' + leitosDisponiveis + ' leitos dispon√≠veis - Considere preparar leitos adicionais'
                });
            }
            
            // Verificar movimenta√ß√µes recentes
            var agora = new Date();
            var movimentacoesRecentes = historicoPacientes.filter(function(evento) {
                var dataEvento = new Date(evento.dataHora);
                var umaHoraAtras = new Date(agora.getTime() - (60 * 60 * 1000));
                return dataEvento >= umaHoraAtras;
            });
            
            if (movimentacoesRecentes.length > 5) {
                alertas.push({
                    tipo: 'info',
                    titulo: 'Alta Movimenta√ß√£o',
                    mensagem: movimentacoesRecentes.length + ' movimenta√ß√µes na √∫ltima hora - Sistema ativo'
                });
            } else if (movimentacoesRecentes.length === 0 && leitosOcupados > 0) {
                alertas.push({
                    tipo: 'info',
                    titulo: 'Sistema Est√°vel',
                    mensagem: 'Nenhuma movimenta√ß√£o na √∫ltima hora - Sistema operando normalmente'
                });
            }
            
            // Renderizar alertas
            alertas.forEach(function(alerta) {
                var item = document.createElement('div');
                item.className = 'alert-item ' + alerta.tipo;
                
                var icon = document.createElement('div');
                icon.className = 'alert-icon';
                icon.textContent = alerta.tipo === 'warning' ? '‚ö†Ô∏è' : alerta.tipo === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
                
                var content = document.createElement('div');
                content.className = 'alert-content';
                
                var title = document.createElement('div');
                title.className = 'alert-title';
                title.textContent = alerta.titulo;
                
                var message = document.createElement('div');
                message.className = 'alert-message';
                message.textContent = alerta.mensagem;
                
                content.appendChild(title);
                content.appendChild(message);
                item.appendChild(icon);
                item.appendChild(content);
                alertsContainer.appendChild(item);
            });
            
            if (alertas.length === 0) {
                alertsContainer.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">Nenhum alerta no momento</div>';
            }
        }
        
        // FUNCAO PARA ABRIR MODAL DE ADMISSAO
        function abrirModal(leitoId) {
            console.log('üîç Debug abrirModal:', {
                leitoId: leitoId,
                usuarioLogado: usuarioLogado,
                permissoes: usuarioLogado ? usuarioLogado.permissoes : 'N/A'
            });
            
            // Verificar se usu√°rio est√° logado
            if (!usuarioLogado) {
                console.log('‚ùå Usu√°rio n√£o est√° logado');
                alert('Voc√™ precisa estar logado para admitir pacientes.');
                return;
            }
            
            // Verificar permiss√£o
            if (!usuarioLogado.permissoes || !usuarioLogado.permissoes.admitir) {
                console.log('‚ùå Sem permiss√£o para admitir pacientes');
                alert('Voc√™ n√£o tem permiss√£o para admitir pacientes.');
                return;
            }
            
            console.log('Abrindo modal para:', leitoId);
            leitoAtual = leitoId;
            document.getElementById('modalTitulo').textContent = 'Admitir Paciente - ' + leitoId;
            
            // Limpar formul√°rio
            document.getElementById('formAdmitir').reset();
            
            // Inicializar contador de observa√ß√µes
            atualizarContadorObservacoes();
            
            document.getElementById('modalAdmitir').style.display = 'block';
        }
        
        // FUNCAO PARA ABRIR MODAL DE TRANSFERENCIA
        function abrirModalTransferir(leitoId) {
            console.log('üîç Debug abrirModalTransferir:', {
                leitoId: leitoId,
                usuarioLogado: usuarioLogado,
                permissoes: usuarioLogado ? usuarioLogado.permissoes : 'N/A'
            });
            
            // Verificar se usu√°rio est√° logado
            if (!usuarioLogado) {
                console.log('‚ùå Usu√°rio n√£o est√° logado');
                alert('Voc√™ precisa estar logado para transferir pacientes.');
                return;
            }
            
            // Verificar permiss√£o
            if (!usuarioLogado.permissoes || !usuarioLogado.permissoes.transferir) {
                console.log('‚ùå Sem permiss√£o para transferir pacientes');
                alert('Voc√™ n√£o tem permiss√£o para transferir pacientes.');
                return;
            }
            
            console.log('Abrindo modal de transferencia para:', leitoId);
            leitoAtual = leitoId;
            
            // OBTER DADOS DO PACIENTE
            var dadosPaciente = dadosLeitos[leitoId];
            
            // PREENCHER INFORMACOES DO PACIENTE
            document.getElementById('infoPacienteNome').textContent = dadosPaciente.pacienteIniciais;
            document.getElementById('infoPacienteRegistro').textContent = dadosPaciente.registro;
            document.getElementById('infoPacienteOrigem').textContent = dadosPaciente.origem;
            document.getElementById('infoPacienteLeito').textContent = dadosPaciente.leito;
            document.getElementById('infoPacienteAdmissao').textContent = new Date(dadosPaciente.dataHoraAdmissao).toLocaleString('pt-BR');
            document.getElementById('infoPacienteObservacoes').textContent = dadosPaciente.observacoes || 'Nenhuma';
            
            document.getElementById('modalTituloTransferir').textContent = 'Transferir Paciente - ' + leitoId;
            document.getElementById('modalTransferir').style.display = 'block';
        }
        
        // FUNCAO PARA FECHAR MODAL DE ADMISSAO
        function fecharModal() {
            document.getElementById('modalAdmitir').style.display = 'none';
            document.getElementById('formAdmitir').reset();
        }
        
        // FUNCAO PARA FECHAR MODAL DE TRANSFERENCIA
        function fecharModalTransferir() {
            document.getElementById('modalTransferir').style.display = 'none';
            document.getElementById('formTransferir').reset();
        }
        
        // FUNCAO PARA TOCAR SOM DE ADMISSAO (Som com quarta justa descendente em 4/4, colcheias, 70 BPM - 7 segundos)
        function tocarSomAdmissao() {
            try {
                // Verificar se o navegador suporta Web Audio API
                if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                    var audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Configura√ß√µes r√≠tmicas: 4/4, colcheias, 70 BPM
                    var bpm = 70;
                    var beatDuration = 60 / bpm; // Dura√ß√£o de uma sem√≠nima em segundos
                    var eighthNoteDuration = beatDuration / 2; // Dura√ß√£o de uma colcheia
                    var totalDuration = 7; // 7 segundos total
                    
                    // Criar dois osciladores para o intervalo de quarta justa descendente
                    var oscillator1 = audioContext.createOscillator(); // Tom mais agudo
                    var oscillator2 = audioContext.createOscillator(); // Tom mais grave (quarta justa abaixo)
                    var gainNode1 = audioContext.createGain();
                    var gainNode2 = audioContext.createGain();
                    
                    // Conectar os n√≥s
                    oscillator1.connect(gainNode1);
                    oscillator2.connect(gainNode2);
                    gainNode1.connect(audioContext.destination);
                    gainNode2.connect(audioContext.destination);
                    
                    // Configurar tipo de onda (onda senoidal suave)
                    oscillator1.type = 'sine';
                    oscillator2.type = 'sine';
                    
                    // Intervalo de quarta justa descendente: L√° (440Hz) para Mi (329.63Hz)
                    oscillator1.frequency.setValueAtTime(440, audioContext.currentTime); // L√° central
                    oscillator2.frequency.setValueAtTime(329.63, audioContext.currentTime); // Mi (quarta justa abaixo)
                    
                    // Configurar volume suave com fade in/out para ambos os tons
                    var volume1 = 0.08; // Volume mais baixo para o tom agudo
                    var volume2 = 0.12; // Volume um pouco maior para o tom grave
                    
                    // Fade in suave
                    gainNode1.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode1.gain.linearRampToValueAtTime(volume1, audioContext.currentTime + 0.5);
                    gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode2.gain.linearRampToValueAtTime(volume2, audioContext.currentTime + 0.5);
                    
                    // Criar padr√£o r√≠tmico 4/4 com colcheias e intervalos mel√≥dicos
                    var currentTime = audioContext.currentTime + 0.5;
                    var endTime = audioContext.currentTime + totalDuration - 0.5;
                    var compassoCount = 0;
                    
                    while (currentTime < endTime) {
                        // Padr√£o mel√≥dico: som-pausa-som-pausa alternando com harmonia
                        for (var beat = 0; beat < 4; beat++) {
                            if (compassoCount % 2 === 0) {
                                // Compassos pares: harmonia (dois tons juntos)
                                // Primeira colcheia do tempo (som forte)
                                gainNode1.gain.setValueAtTime(volume1, currentTime);
                                gainNode2.gain.setValueAtTime(volume2, currentTime);
                                gainNode1.gain.setValueAtTime(volume1 * 0.3, currentTime + eighthNoteDuration * 0.8);
                                gainNode2.gain.setValueAtTime(volume2 * 0.3, currentTime + eighthNoteDuration * 0.8);
                                
                                currentTime += eighthNoteDuration;
                                
                                // Segunda colcheia do tempo (pausa)
                                gainNode1.gain.setValueAtTime(0, currentTime);
                                gainNode2.gain.setValueAtTime(0, currentTime);
                                
                                currentTime += eighthNoteDuration;
                            } else {
                                // Compassos √≠mpares: melodia (tom agudo sozinho)
                                // Primeira colcheia do tempo (som forte - s√≥ tom agudo)
                                gainNode1.gain.setValueAtTime(volume1 * 1.2, currentTime);
                                gainNode2.gain.setValueAtTime(0, currentTime);
                                gainNode1.gain.setValueAtTime(volume1 * 0.4, currentTime + eighthNoteDuration * 0.8);
                                
                                currentTime += eighthNoteDuration;
                                
                                // Segunda colcheia do tempo (pausa)
                                gainNode1.gain.setValueAtTime(0, currentTime);
                                gainNode2.gain.setValueAtTime(0, currentTime);
                                
                                currentTime += eighthNoteDuration;
                            }
                        }
                        compassoCount++;
                    }
                    
                    // Fade out suave
                    gainNode1.gain.linearRampToValueAtTime(0, audioContext.currentTime + totalDuration);
                    gainNode2.gain.linearRampToValueAtTime(0, audioContext.currentTime + totalDuration);
                    
                    // Reproduzir som por 7 segundos
                    oscillator1.start(audioContext.currentTime);
                    oscillator2.start(audioContext.currentTime);
                    oscillator1.stop(audioContext.currentTime + totalDuration);
                    oscillator2.stop(audioContext.currentTime + totalDuration);
                    
                    console.log('Som de admiss√£o (quarta justa descendente L√°-Mi em 4/4, colcheias, 70 BPM) reproduzido por 7 segundos');
                } else {
                    // Fallback: usar beep do sistema
                    console.log('Web Audio API n√£o suportada, usando fallback');
                    // Tentar usar Audio() como fallback
                    var audio = new Audio();
                    audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT';
                    audio.play().catch(function(e) {
                        console.log('Fallback de √°udio tamb√©m falhou:', e);
                    });
                }
            } catch (e) {
                console.log('Erro ao reproduzir som de admiss√£o:', e);
            }
        }
        
        // FUNCAO PARA TOCAR SOM DE TRANSFERENCIA (Som com quinta justa descendente em 4/4, colcheias, 70 BPM - 5 segundos)
        function tocarSomTransferencia() {
            try {
                // Criar um som de notifica√ß√£o usando Web Audio API
                var audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Configura√ß√µes r√≠tmicas: 4/4, colcheias, 70 BPM
                var bpm = 70;
                var beatDuration = 60 / bpm; // Dura√ß√£o de uma sem√≠nima em segundos
                var eighthNoteDuration = beatDuration / 2; // Dura√ß√£o de uma colcheia
                var totalDuration = 5; // 5 segundos total
                
                // Criar dois osciladores para o intervalo de quinta justa descendente
                var oscillator1 = audioContext.createOscillator(); // Tom mais agudo
                var oscillator2 = audioContext.createOscillator(); // Tom mais grave (quinta justa abaixo)
                var gainNode1 = audioContext.createGain();
                var gainNode2 = audioContext.createGain();
                
                oscillator1.connect(gainNode1);
                oscillator2.connect(gainNode2);
                gainNode1.connect(audioContext.destination);
                gainNode2.connect(audioContext.destination);
                
                // Configurar tipo de onda suave
                oscillator1.type = 'sine';
                oscillator2.type = 'sine';
                
                // Intervalo de quinta justa descendente: D√≥ (523.25Hz) para F√° (349.23Hz)
                oscillator1.frequency.setValueAtTime(523.25, audioContext.currentTime); // D√≥
                oscillator2.frequency.setValueAtTime(349.23, audioContext.currentTime); // F√° (quinta justa abaixo)
                
                // Configurar volume suave com fade in/out para ambos os tons
                var volume1 = 0.07; // Volume mais baixo para o tom agudo
                var volume2 = 0.11; // Volume um pouco maior para o tom grave
                
                // Fade in suave
                gainNode1.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode1.gain.linearRampToValueAtTime(volume1, audioContext.currentTime + 0.3);
                gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode2.gain.linearRampToValueAtTime(volume2, audioContext.currentTime + 0.3);
                
                // Criar padr√£o r√≠tmico 4/4 com colcheias e intervalos mel√≥dicos
                var currentTime = audioContext.currentTime + 0.3;
                var endTime = audioContext.currentTime + totalDuration - 0.3;
                var compassoCount = 0;
                
                while (currentTime < endTime) {
                    // Padr√£o mel√≥dico: som-pausa-som-pausa alternando com harmonia
                    for (var beat = 0; beat < 4; beat++) {
                        if (compassoCount % 2 === 0) {
                            // Compassos pares: harmonia (dois tons juntos)
                            // Primeira colcheia do tempo (som forte)
                            gainNode1.gain.setValueAtTime(volume1, currentTime);
                            gainNode2.gain.setValueAtTime(volume2, currentTime);
                            gainNode1.gain.setValueAtTime(volume1 * 0.3, currentTime + eighthNoteDuration * 0.8);
                            gainNode2.gain.setValueAtTime(volume2 * 0.3, currentTime + eighthNoteDuration * 0.8);
                            
                            currentTime += eighthNoteDuration;
                            
                            // Segunda colcheia do tempo (pausa)
                            gainNode1.gain.setValueAtTime(0, currentTime);
                            gainNode2.gain.setValueAtTime(0, currentTime);
                            
                            currentTime += eighthNoteDuration;
                        } else {
                            // Compassos √≠mpares: melodia (tom agudo sozinho)
                            // Primeira colcheia do tempo (som forte - s√≥ tom agudo)
                            gainNode1.gain.setValueAtTime(volume1 * 1.2, currentTime);
                            gainNode2.gain.setValueAtTime(0, currentTime);
                            gainNode1.gain.setValueAtTime(volume1 * 0.4, currentTime + eighthNoteDuration * 0.8);
                            
                            currentTime += eighthNoteDuration;
                            
                            // Segunda colcheia do tempo (pausa)
                            gainNode1.gain.setValueAtTime(0, currentTime);
                            gainNode2.gain.setValueAtTime(0, currentTime);
                            
                            currentTime += eighthNoteDuration;
                        }
                    }
                    compassoCount++;
                }
                
                // Fade out suave
                gainNode1.gain.linearRampToValueAtTime(0, audioContext.currentTime + totalDuration);
                gainNode2.gain.linearRampToValueAtTime(0, audioContext.currentTime + totalDuration);
                
                oscillator1.start(audioContext.currentTime);
                oscillator2.start(audioContext.currentTime);
                oscillator1.stop(audioContext.currentTime + totalDuration);
                oscillator2.stop(audioContext.currentTime + totalDuration);
                
                console.log('Som de transfer√™ncia (quinta justa descendente D√≥-F√° em 4/4, colcheias, 70 BPM) reproduzido por 5 segundos');
            } catch (e) {
                console.log('Erro ao reproduzir som de transfer√™ncia:', e);
            }
        }
        
        // FUNCAO PARA TOCAR SOM DE ALTA (Som com ter√ßa maior descendente em 4/4, colcheias, 70 BPM - 3 segundos)
        function tocarSomAlta() {
            try {
                // Criar um som de notifica√ß√£o usando Web Audio API
                var audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Configura√ß√µes r√≠tmicas: 4/4, colcheias, 70 BPM
                var bpm = 70;
                var beatDuration = 60 / bpm; // Dura√ß√£o de uma sem√≠nima em segundos
                var eighthNoteDuration = beatDuration / 2; // Dura√ß√£o de uma colcheia
                var totalDuration = 3; // 3 segundos total
                
                // Criar dois osciladores para o intervalo de ter√ßa maior descendente
                var oscillator1 = audioContext.createOscillator(); // Tom mais agudo
                var oscillator2 = audioContext.createOscillator(); // Tom mais grave (ter√ßa maior abaixo)
                var gainNode1 = audioContext.createGain();
                var gainNode2 = audioContext.createGain();
                
                oscillator1.connect(gainNode1);
                oscillator2.connect(gainNode2);
                gainNode1.connect(audioContext.destination);
                gainNode2.connect(audioContext.destination);
                
                // Configurar tipo de onda suave
                oscillator1.type = 'sine';
                oscillator2.type = 'sine';
                
                // Intervalo de ter√ßa maior descendente: Mi (659.25Hz) para D√≥ (523.25Hz)
                oscillator1.frequency.setValueAtTime(659.25, audioContext.currentTime); // Mi
                oscillator2.frequency.setValueAtTime(523.25, audioContext.currentTime); // D√≥ (ter√ßa maior abaixo)
                
                // Configurar volume suave com fade in/out para ambos os tons
                var volume1 = 0.06; // Volume mais baixo para o tom agudo
                var volume2 = 0.10; // Volume um pouco maior para o tom grave
                
                // Fade in suave
                gainNode1.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode1.gain.linearRampToValueAtTime(volume1, audioContext.currentTime + 0.2);
                gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode2.gain.linearRampToValueAtTime(volume2, audioContext.currentTime + 0.2);
                
                // Criar padr√£o r√≠tmico 4/4 com colcheias e intervalos mel√≥dicos
                var currentTime = audioContext.currentTime + 0.2;
                var endTime = audioContext.currentTime + totalDuration - 0.2;
                var compassoCount = 0;
                
                while (currentTime < endTime) {
                    // Padr√£o mel√≥dico: som-pausa-som-pausa alternando com harmonia
                    for (var beat = 0; beat < 4; beat++) {
                        if (compassoCount % 2 === 0) {
                            // Compassos pares: harmonia (dois tons juntos)
                            // Primeira colcheia do tempo (som forte)
                            gainNode1.gain.setValueAtTime(volume1, currentTime);
                            gainNode2.gain.setValueAtTime(volume2, currentTime);
                            gainNode1.gain.setValueAtTime(volume1 * 0.3, currentTime + eighthNoteDuration * 0.8);
                            gainNode2.gain.setValueAtTime(volume2 * 0.3, currentTime + eighthNoteDuration * 0.8);
                            
                            currentTime += eighthNoteDuration;
                            
                            // Segunda colcheia do tempo (pausa)
                            gainNode1.gain.setValueAtTime(0, currentTime);
                            gainNode2.gain.setValueAtTime(0, currentTime);
                            
                            currentTime += eighthNoteDuration;
                        } else {
                            // Compassos √≠mpares: melodia (tom agudo sozinho)
                            // Primeira colcheia do tempo (som forte - s√≥ tom agudo)
                            gainNode1.gain.setValueAtTime(volume1 * 1.2, currentTime);
                            gainNode2.gain.setValueAtTime(0, currentTime);
                            gainNode1.gain.setValueAtTime(volume1 * 0.4, currentTime + eighthNoteDuration * 0.8);
                            
                            currentTime += eighthNoteDuration;
                            
                            // Segunda colcheia do tempo (pausa)
                            gainNode1.gain.setValueAtTime(0, currentTime);
                            gainNode2.gain.setValueAtTime(0, currentTime);
                            
                            currentTime += eighthNoteDuration;
                        }
                    }
                    compassoCount++;
                }
                
                // Fade out suave
                gainNode1.gain.linearRampToValueAtTime(0, audioContext.currentTime + totalDuration);
                gainNode2.gain.linearRampToValueAtTime(0, audioContext.currentTime + totalDuration);
                
                oscillator1.start(audioContext.currentTime);
                oscillator2.start(audioContext.currentTime);
                oscillator1.stop(audioContext.currentTime + totalDuration);
                oscillator2.stop(audioContext.currentTime + totalDuration);
                
                console.log('Som de alta (ter√ßa maior descendente Mi-D√≥ em 4/4, colcheias, 70 BPM) reproduzido por 3 segundos');
            } catch (e) {
                console.log('Erro ao reproduzir som de alta:', e);
            }
        }
        
        // FUNCAO PARA CALCULAR IDADE
        function calcularIdade(dataNascimento) {
            var hoje = new Date();
            var nascimento = new Date(dataNascimento);
            var idade = hoje.getFullYear() - nascimento.getFullYear();
            var mes = hoje.getMonth() - nascimento.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
                idade--;
            }
            
            return idade;
        }
        
        // FUNCAO PARA FORMATAR DATA DE NASCIMENTO
        function formatarDataNascimento(dataNascimento) {
            var data = new Date(dataNascimento);
            return data.toLocaleDateString('pt-BR');
        }
        
        // FUNCAO PARA ATUALIZAR CONTADOR DE OBSERVACOES
        function atualizarContadorObservacoes() {
            var textarea = document.getElementById('observacoes');
            var contador = document.getElementById('contadorObservacoes');
            var caracteres = textarea.value.length;
            var maxCaracteres = 500;
            
            contador.textContent = caracteres + '/' + maxCaracteres + ' caracteres';
            
            // Mudar cor baseada na quantidade de caracteres
            contador.className = 'char-counter';
            if (caracteres > maxCaracteres * 0.8) {
                contador.className += ' warning';
            }
            if (caracteres > maxCaracteres * 0.95) {
                contador.className += ' danger';
            }
        }
        
        // FUNCAO PARA SALVAR ADMISSAO
        function salvarAdmissao(event) {
            event.preventDefault();
            console.log('Salvando admissao para:', leitoAtual);
            
            var pacienteIniciais = document.getElementById('pacienteIniciais').value.toUpperCase();
            var registro = document.getElementById('registro').value;
            var dataNascimento = document.getElementById('dataNascimento').value;
            var origem = document.getElementById('origem').value;
            var observacoes = document.getElementById('observacoes').value;
            
            // Validar campos obrigat√≥rios
            if (!pacienteIniciais || !registro || !dataNascimento || !origem) {
                alert('Por favor, preencha todos os campos obrigat√≥rios (marcados com *).');
                return;
            }
            
            // Validar comprimento das observa√ß√µes
            if (observacoes.length > 500) {
                alert('As observa√ß√µes n√£o podem exceder 500 caracteres.');
                return;
            }
            
            // Calcular idade
            var idade = calcularIdade(dataNascimento);
            
            var dados = {
                pacienteIniciais: pacienteIniciais,
                registro: registro,
                dataNascimento: dataNascimento,
                idade: idade,
                origem: origem,
                observacoes: observacoes,
                dataHoraAdmissao: new Date().toISOString(),
                leito: leitoAtual
            };
            
            // SALVAR DADOS DO LEITO (Firebase + Local)
            dadosLeitos[leitoAtual] = dados;
            salvarNoFirebase('leitos', leitoAtual, dados);
            
            // ADICIONAR AO HISTORICO
            var historicoItem = {
                pacienteIniciais: pacienteIniciais,
                registro: registro,
                dataNascimento: dataNascimento,
                idade: idade,
                origem: origem,
                observacoes: observacoes,
                dataHoraAdmissao: dados.dataHoraAdmissao,
                leito: leitoAtual,
                usuarioAcao: usuarioLogado.nome || 'Sistema',
                setorAcao: usuarioLogado.setor || 'Sistema',
                dataHoraSaida: null,
                destino: null,
                status: 'EM ATENDIMENTO',
                tipo: 'admissao',
                dataHora: dados.dataHoraAdmissao,
                paciente: pacienteIniciais
            };
            
            historicoPacientes.push(historicoItem);
            salvarNoFirebase('historico', Date.now().toString(), historicoItem);
            
            // ATUALIZAR INTERFACE
            atualizarLeito(leitoAtual, dados);
            
            // TOCAR SOM DE ADMISSAO
            tocarSomAdmissao();
            
            // ENVIAR EMAIL DE ADMISSAO
            enviarEmailAdmissao(dados);
            
            // ENVIAR WHATSAPP DE ADMISSAO
            enviarWhatsAppAdmissao(dados);
            
            alert('‚úÖ Paciente ' + pacienteIniciais + ' admitido no ' + leitoAtual + ' com sucesso!');
            
            // FECHAR MODAL E ATUALIZAR INTERFACE
            fecharModal();
            renderizarLeitos();
        }
        
        // FUNCAO PARA SALVAR TRANSFERENCIA
        function salvarTransferencia(event) {
            event.preventDefault();
            console.log('Salvando transferencia para:', leitoAtual);
            
            var destino = document.getElementById('destino').value;
            var observacoesTransferencia = document.getElementById('observacoesTransferencia').value;
            
            // OBTER DADOS DO PACIENTE
            var dadosPaciente = dadosLeitos[leitoAtual];
            
            // ATUALIZAR HISTORICO
            for (var i = 0; i < historicoPacientes.length; i++) {
                if (historicoPacientes[i].leito === leitoAtual && historicoPacientes[i].dataHoraSaida === null) {
                    historicoPacientes[i].dataHoraSaida = new Date().toISOString();
                    historicoPacientes[i].destino = destino;
                    historicoPacientes[i].status = 'TRANSFERIDO';
                    historicoPacientes[i].usuarioAcao = usuarioLogado.nome || 'Sistema';
                    historicoPacientes[i].setorAcao = usuarioLogado.setor || 'Sistema';
                    break;
                }
            }
            
            // SALVAR NO FIREBASE
            var dadosLeitoVago = {
                status: 'VAGO',
                pacienteIniciais: '',
                registro: '',
                origem: '',
                dataHoraAdmissao: null,
                dataHoraSaida: null,
                observacoes: '',
                dataNascimento: '',
                idade: ''
            };
            
            salvarNoFirebase('leitos', leitoAtual, dadosLeitoVago);
            
            // Adicionar ao hist√≥rico no Firebase
            var historicoItem = {
                leito: leitoAtual,
                pacienteIniciais: dadosPaciente.pacienteIniciais,
                registro: dadosPaciente.registro,
                origem: dadosPaciente.origem,
                destino: destino,
                dataHoraAdmissao: dadosPaciente.dataHoraAdmissao,
                dataHoraSaida: new Date().toISOString(),
                status: 'TRANSFERIDO',
                observacoes: observacoesTransferencia,
                dataNascimento: dadosPaciente.dataNascimento || '',
                idade: dadosPaciente.idade || '',
                usuarioAcao: usuarioLogado.nome || 'Sistema',
                setorAcao: usuarioLogado.setor || 'Sistema'
            };
            
            salvarNoFirebase('historico', Date.now().toString(), historicoItem);
            
            // ATUALIZAR LEITO LOCAL
            dadosLeitos[leitoAtual] = dadosLeitoVago;
            limparLeito(leitoAtual);
            
            // TOCAR SOM DE TRANSFERENCIA
            tocarSomTransferencia();
            
            // ENVIAR EMAIL DE TRANSFERENCIA
            var dadosEmail = {
                pacienteIniciais: dadosPaciente.pacienteIniciais,
                registro: dadosPaciente.registro,
                origem: dadosPaciente.origem,
                destino: destino,
                leito: leitoAtual,
                dataHoraSaida: new Date().toISOString(),
                observacoes: observacoesTransferencia
            };
            enviarEmailTransferencia(dadosEmail);
            
            // ENVIAR WHATSAPP DE TRANSFERENCIA
            enviarWhatsAppTransferencia(dadosEmail);
            
            alert('‚úÖ Paciente ' + dadosPaciente.pacienteIniciais + ' transferido para ' + destino + ' com sucesso!');
            
            // FECHAR MODAL E ATUALIZAR INTERFACE
            fecharModalTransferir();
            renderizarLeitos();
        }
        
        // FUNCAO PARA ATUALIZAR O LEITO
        function atualizarLeito(leitoId, dados) {
            console.log('Atualizando leito:', leitoId);
            
            var leitoCard = document.getElementById('leito-' + leitoId);
            
            if (leitoCard) {
                // ATUALIZAR STATUS BADGE
                var statusBadge = document.getElementById('status-' + leitoId);
                statusBadge.textContent = 'EM ATENDIMENTO';
                statusBadge.className = 'status-badge ocupado';
                
                // ATUALIZAR INFORMACOES
                var leitoInfo = document.getElementById('info-' + leitoId);
                var dataHora = new Date(dados.dataHoraAdmissao).toLocaleString('pt-BR');
                
                var observacoesHtml = '';
                if (dados.observacoes) {
                    observacoesHtml = '<div class="info-row"><span class="info-label">Obs:</span><span class="info-value">' + dados.observacoes + '</span></div>';
                }
                
                leitoInfo.innerHTML = 
                    '<div class="info-row">' +
                        '<span class="info-label">Paciente:</span>' +
                        '<span class="info-value"><strong>' + dados.pacienteIniciais + '</strong></span>' +
                    '</div>' +
                    '<div class="info-row">' +
                        '<span class="info-label">Registro:</span>' +
                        '<span class="info-value">' + dados.registro + '</span>' +
                    '</div>' +
                    '<div class="info-row">' +
                        '<span class="info-label">Nascimento:</span>' +
                        '<span class="info-value">' + formatarDataNascimento(dados.dataNascimento) + ' (' + dados.idade + ' anos)</span>' +
                    '</div>' +
                    '<div class="info-row">' +
                        '<span class="info-label">Origem:</span>' +
                        '<span class="info-value">' + dados.origem + '</span>' +
                    '</div>' +
                    '<div class="info-row">' +
                        '<span class="info-label">Admissao:</span>' +
                        '<span class="info-value">' + dataHora + '</span>' +
                    '</div>' +
                    observacoesHtml;
                
                // ATUALIZAR BOTOES
                var btn = leitoCard.querySelector('.btn');
                btn.innerHTML = 
                    '<button class="btn btn-warning" onclick="abrirModalTransferir(\'' + leitoId + '\')">Transferir</button>' +
                    '<button class="btn btn-danger" onclick="darAlta(\'' + leitoId + '\')">Dar Alta</button>';
            }
        }
        
        // FUNCAO PARA DAR ALTA
        function darAlta(leitoId) {
            console.log('üîç Debug darAlta:', {
                leitoId: leitoId,
                usuarioLogado: usuarioLogado,
                permissoes: usuarioLogado ? usuarioLogado.permissoes : 'N/A'
            });
            
            // Verificar se usu√°rio est√° logado
            if (!usuarioLogado) {
                console.log('‚ùå Usu√°rio n√£o est√° logado');
                alert('Voc√™ precisa estar logado para dar alta de pacientes.');
                return;
            }
            
            // Verificar permiss√£o
            if (!usuarioLogado.permissoes || !usuarioLogado.permissoes.darAlta) {
                console.log('‚ùå Sem permiss√£o para dar alta de pacientes');
                alert('Voc√™ n√£o tem permiss√£o para dar alta de pacientes.');
                return;
            }
            
            if (confirm('Confirmar alta do paciente no ' + leitoId + '?')) {
                // OBTER DADOS DO PACIENTE
                var dadosPaciente = dadosLeitos[leitoId];
                
                // ATUALIZAR HISTORICO
                for (var i = 0; i < historicoPacientes.length; i++) {
                    if (historicoPacientes[i].leito === leitoId && historicoPacientes[i].dataHoraSaida === null) {
                        historicoPacientes[i].dataHoraSaida = new Date().toISOString();
                        historicoPacientes[i].destino = 'ALTA HOSPITALAR';
                        historicoPacientes[i].status = 'ALTA';
                        historicoPacientes[i].usuarioAcao = usuarioLogado.nome || 'Sistema';
                        historicoPacientes[i].setorAcao = usuarioLogado.setor || 'Sistema';
                        break;
                    }
                }
                
                // SALVAR NO FIREBASE
                var dadosLeitoVago = {
                    status: 'VAGO',
                    pacienteIniciais: '',
                    registro: '',
                    origem: '',
                    dataHoraAdmissao: null,
                    dataHoraSaida: null,
                    observacoes: '',
                    dataNascimento: '',
                    idade: ''
                };
                
                salvarNoFirebase('leitos', leitoId, dadosLeitoVago);
                
                // Adicionar ao hist√≥rico no Firebase
                var historicoItem = {
                    leito: leitoId,
                    pacienteIniciais: dadosPaciente.pacienteIniciais,
                    registro: dadosPaciente.registro,
                    origem: dadosPaciente.origem,
                    destino: 'ALTA HOSPITALAR',
                    dataHoraAdmissao: dadosPaciente.dataHoraAdmissao,
                    dataHoraSaida: new Date().toISOString(),
                    status: 'ALTA',
                    observacoes: dadosPaciente.observacoes || '',
                    dataNascimento: dadosPaciente.dataNascimento || '',
                    idade: dadosPaciente.idade || '',
                    usuarioAcao: usuarioLogado.nome || 'Sistema',
                    setorAcao: usuarioLogado.setor || 'Sistema'
                };
                
                salvarNoFirebase('historico', Date.now().toString(), historicoItem);
                
                // ATUALIZAR LEITO LOCAL
                dadosLeitos[leitoId] = dadosLeitoVago;
                limparLeito(leitoId);
                
                // TOCAR SOM DE ALTA
                tocarSomAlta();
                
                // ENVIAR EMAIL DE ALTA
                var dadosEmail = {
                    pacienteIniciais: dadosPaciente.pacienteIniciais,
                    registro: dadosPaciente.registro,
                    origem: dadosPaciente.origem,
                    leito: leitoId,
                    dataHoraEntrada: dadosPaciente.dataHoraAdmissao,
                    dataHoraSaida: new Date().toISOString(),
                    observacoes: dadosPaciente.observacoes
                };
                enviarEmailAlta(dadosEmail);
                
                // ENVIAR WHATSAPP DE ALTA
                enviarWhatsAppAlta(dadosEmail);
                
                alert('‚úÖ Alta registrada para o ' + leitoId + '!');
                
                // ATUALIZAR INTERFACE
                renderizarLeitos();
            }
        }
        
        // FUNCAO PARA RESTAURAR LEITO
        function restaurarLeito(leitoId) {
            var leitoCard = document.getElementById('leito-' + leitoId);
            
            if (leitoCard) {
                // RESTAURAR STATUS ORIGINAL
                var statusBadge = document.getElementById('status-' + leitoId);
                statusBadge.textContent = 'VAGO';
                statusBadge.className = 'status-badge';
                
                // RESTAURAR INFORMACOES ORIGINAIS
                var leitoInfo = document.getElementById('info-' + leitoId);
                leitoInfo.innerHTML = 
                    '<div class="info-row">' +
                        '<span class="info-label">Status:</span>' +
                        '<span class="info-value">Leito disponivel</span>' +
                    '</div>';
                
                // RESTAURAR BOTAO ORIGINAL
                var btn = leitoCard.querySelector('.btn');
                btn.innerHTML = '<button class="btn" onclick="abrirModal(\'' + leitoId + '\')">Admitir Paciente</button>';
            }
        }
        
        // FUNCAO PARA LIMPAR LEITO (para transfer√™ncia e alta)
        function limparLeito(leitoId) {
            console.log('Limpando leito:', leitoId);
            
            var leitoCard = document.getElementById('leito-' + leitoId);
            
            if (leitoCard) {
                // ATUALIZAR STATUS BADGE
                var statusBadge = document.getElementById('status-' + leitoId);
                statusBadge.textContent = 'VAGO';
                statusBadge.className = 'status-badge';
                
                // LIMPAR INFORMACOES
                var leitoInfo = document.getElementById('info-' + leitoId);
                leitoInfo.innerHTML = 
                    '<div class="info-row">' +
                        '<span class="info-label">Status:</span>' +
                        '<span class="info-value">Leito disponivel</span>' +
                    '</div>';
                
                // RESTAURAR BOTAO ORIGINAL
                var btn = leitoCard.querySelector('.btn');
                btn.innerHTML = '<button class="btn" onclick="abrirModal(\'' + leitoId + '\')">Admitir Paciente</button>';
                
                console.log('Leito limpo com sucesso:', leitoId);
            }
        }
        
        // FUNCAO PARA MOSTRAR FARMACIA
        function mostrarFarmacia() {
            switchPanel('farmaciaPanel');
            renderizarFarmacia();
        }
        
        // FUNCAO PARA RENDERIZAR FARMACIA
        function renderizarFarmacia() {
            var content = document.getElementById('farmaciaContent');
            
            // FILTRAR APENAS PACIENTES ATIVOS (leitos ocupados)
            var pacientesAtivos = Object.values(dadosLeitos).filter(function(leito) {
                return leito.status === 'EM ATENDIMENTO' && leito.pacienteIniciais && leito.pacienteIniciais.trim() !== '';
            });
            
            // ATUALIZAR ESTATISTICAS
            document.getElementById('totalAtivos').textContent = pacientesAtivos.length;
            document.getElementById('totalLeitos').textContent = Object.keys(dadosLeitos).length;
            document.getElementById('leitosDisponiveis').textContent = 15 - Object.keys(dadosLeitos).length;
            
            if (pacientesAtivos.length === 0) {
                content.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;"><i class="fas fa-user-injured" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i><p style="font-size: 1.1rem;">Nenhum paciente em atendimento no momento.</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < pacientesAtivos.length; i++) {
                var dados = pacientesAtivos[i];
                var tempoInicio = new Date(dados.dataHoraAdmissao);
                var tempoAtual = new Date();
                var diffMs = tempoAtual - tempoInicio;
                var diffHoras = Math.floor(diffMs / (1000 * 60 * 60));
                var diffMinutos = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                
                var observacoesHtml = '';
                if (dados.observacoes) {
                    observacoesHtml = 
                        '<div class="farmacia-observacoes">' +
                            '<div class="farmacia-observacoes-label">Observacoes:</div>' +
                            '<div class="farmacia-observacoes-value">' + dados.observacoes + '</div>' +
                        '</div>';
                }
                
                html += 
                    '<div class="farmacia-card">' +
                        '<div class="farmacia-card-header">' +
                            '<div class="farmacia-card-title"><strong>' + dados.pacienteIniciais + '</strong></div>' +
                            '<div class="farmacia-card-leito">' + dados.leito + '</div>' +
                        '</div>' +
                        '<div class="farmacia-card-info">' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Registro:</span>' +
                                '<span class="farmacia-info-value">' + dados.registro + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Nascimento:</span>' +
                                '<span class="farmacia-info-value">' + (dados.dataNascimento ? formatarDataNascimento(dados.dataNascimento) + ' (' + dados.idade + ' anos)' : 'N/A') + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Origem:</span>' +
                                '<span class="farmacia-info-value">' + dados.origem + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Admissao:</span>' +
                                '<span class="farmacia-info-value">' + new Date(dados.dataHoraAdmissao).toLocaleString('pt-BR') + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Tempo no PA:</span>' +
                                '<span class="farmacia-info-value">' + diffHoras + 'h ' + diffMinutos + 'min</span>' +
                            '</div>' +
                        '</div>' +
                        observacoesHtml +
                    '</div>';
            }
            
            content.innerHTML = html;
        }
        
        // FUNCAO PARA FILTRAR FARMACIA
        function filtrarFarmacia() {
            var filtro = document.getElementById('filterFarmacia').value.toLowerCase();
            var pacientesAtivos = Object.values(dadosLeitos);
            
            var content = document.getElementById('farmaciaContent');
            
            if (pacientesAtivos.length === 0) {
                content.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;"><i class="fas fa-user-injured" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i><p style="font-size: 1.1rem;">Nenhum paciente em atendimento no momento.</p></div>';
                return;
            }
            
            var html = '';
            var pacientesFiltrados = 0;
            
            for (var i = 0; i < pacientesAtivos.length; i++) {
                var dados = pacientesAtivos[i];
                
                if (filtro && !dados.pacienteIniciais.toLowerCase().includes(filtro)) {
                    continue;
                }
                
                pacientesFiltrados++;
                var tempoInicio = new Date(dados.dataHoraAdmissao);
                var tempoAtual = new Date();
                var diffMs = tempoAtual - tempoInicio;
                var diffHoras = Math.floor(diffMs / (1000 * 60 * 60));
                var diffMinutos = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                
                var observacoesHtml = '';
                if (dados.observacoes) {
                    observacoesHtml = 
                        '<div class="farmacia-observacoes">' +
                            '<div class="farmacia-observacoes-label">Observacoes:</div>' +
                            '<div class="farmacia-observacoes-value">' + dados.observacoes + '</div>' +
                        '</div>';
                }
                
                html += 
                    '<div class="farmacia-card">' +
                        '<div class="farmacia-card-header">' +
                            '<div class="farmacia-card-title"><strong>' + dados.pacienteIniciais + '</strong></div>' +
                            '<div class="farmacia-card-leito">' + dados.leito + '</div>' +
                        '</div>' +
                        '<div class="farmacia-card-info">' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Registro:</span>' +
                                '<span class="farmacia-info-value">' + dados.registro + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Nascimento:</span>' +
                                '<span class="farmacia-info-value">' + (dados.dataNascimento ? formatarDataNascimento(dados.dataNascimento) + ' (' + dados.idade + ' anos)' : 'N/A') + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Origem:</span>' +
                                '<span class="farmacia-info-value">' + dados.origem + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Admissao:</span>' +
                                '<span class="farmacia-info-value">' + new Date(dados.dataHoraAdmissao).toLocaleString('pt-BR') + '</span>' +
                            '</div>' +
                            '<div class="farmacia-info-row">' +
                                '<span class="farmacia-info-label">Tempo no PA:</span>' +
                                '<span class="farmacia-info-value">' + diffHoras + 'h ' + diffMinutos + 'min</span>' +
                            '</div>' +
                        '</div>' +
                        observacoesHtml +
                    '</div>';
            }
            
            if (pacientesFiltrados === 0) {
                html = '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #7f8c8d;"><i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i><p style="font-size: 1.1rem;">Nenhum paciente encontrado com o filtro aplicado.</p></div>';
            }
            
            content.innerHTML = html;
        }
        
        // FUNCAO PARA LIMPAR FILTROS FARMACIA
        function limparFiltrosFarmacia() {
            document.getElementById('filterFarmacia').value = '';
            renderizarFarmacia();
        }
        
        // FUNCAO PARA MOSTRAR RASTREABILIDADE
        function mostrarRastreabilidade() {
            switchPanel('rastreabilidadePanel');
            renderizarRastreabilidade();
        }
        
        // FUNCAO PARA RENDERIZAR RASTREABILIDADE
        function renderizarRastreabilidade() {
            var tbody = document.getElementById('rastreabilidadeBody');
            tbody.innerHTML = '';
            
            for (var i = 0; i < historicoPacientes.length; i++) {
                var historico = historicoPacientes[i];
                var row = tbody.insertRow();
                row.insertCell().innerHTML = '<strong>' + historico.pacienteIniciais + '</strong>';
                row.insertCell().textContent = historico.registro;
                row.insertCell().textContent = historico.origem;
                row.insertCell().textContent = historico.leito;
                row.insertCell().textContent = new Date(historico.dataHoraAdmissao).toLocaleString('pt-BR');
                row.insertCell().textContent = historico.dataHoraSaida ? new Date(historico.dataHoraSaida).toLocaleString('pt-BR') : 'Ainda no PA';
                row.insertCell().textContent = historico.destino || 'Ainda no PA';
                row.insertCell().textContent = historico.status;
                row.insertCell().innerHTML = '<span style="color: #007bff; font-weight: bold;">' + (historico.usuarioAcao || 'Sistema') + '</span>';
                row.insertCell().textContent = historico.setorAcao || 'Sistema';
            }
        }
        
        // FUNCAO PARA FILTRAR RASTREABILIDADE
        function filtrarRastreabilidade() {
            var filtroPaciente = document.getElementById('filterPaciente').value.toLowerCase();
            var filtroOrigem = document.getElementById('filterOrigem').value.toLowerCase();
            var filtroData = document.getElementById('filterData').value;
            
            var tbody = document.getElementById('rastreabilidadeBody');
            tbody.innerHTML = '';
            
            for (var i = 0; i < historicoPacientes.length; i++) {
                var historico = historicoPacientes[i];
                
                // APLICAR FILTROS
                if (filtroPaciente && !historico.pacienteIniciais.toLowerCase().includes(filtroPaciente)) {
                    continue;
                }
                if (filtroOrigem && !historico.origem.toLowerCase().includes(filtroOrigem)) {
                    continue;
                }
                if (filtroData) {
                    var dataAdmissao = new Date(historico.dataHoraAdmissao).toISOString().split('T')[0];
                    if (dataAdmissao !== filtroData) {
                        continue;
                    }
                }
                
                var row = tbody.insertRow();
                row.insertCell().innerHTML = '<strong>' + historico.pacienteIniciais + '</strong>';
                row.insertCell().textContent = historico.registro;
                row.insertCell().textContent = historico.origem;
                row.insertCell().textContent = historico.leito;
                row.insertCell().textContent = new Date(historico.dataHoraAdmissao).toLocaleString('pt-BR');
                row.insertCell().textContent = historico.dataHoraSaida ? new Date(historico.dataHoraSaida).toLocaleString('pt-BR') : 'Ainda no PA';
                row.insertCell().textContent = historico.destino || 'Ainda no PA';
                row.insertCell().textContent = historico.status;
                row.insertCell().innerHTML = '<span style="color: #007bff; font-weight: bold;">' + (historico.usuarioAcao || 'Sistema') + '</span>';
                row.insertCell().textContent = historico.setorAcao || 'Sistema';
            }
        }
        
        // FUNCAO PARA LIMPAR FILTROS RASTREABILIDADE
        function limparFiltrosRastreabilidade() {
            document.getElementById('filterPaciente').value = '';
            document.getElementById('filterOrigem').value = '';
            document.getElementById('filterData').value = '';
            renderizarRastreabilidade();
        }
        
        // FUNCAO PARA MOSTRAR RELATORIOS
        function mostrarRelatorios() {
            switchPanel('relatoriosPanel');
        }
        
        // FUNCAO PARA GERAR RELATORIO
        function gerarRelatorio() {
            var dataInicio = document.getElementById('dataInicio').value;
            var dataFim = document.getElementById('dataFim').value;
            var tipoRelatorio = document.getElementById('tipoRelatorio').value;
            
            var dadosFiltrados = historicoPacientes;
            
            if (dataInicio && dataFim) {
                dadosFiltrados = [];
                for (var i = 0; i < historicoPacientes.length; i++) {
                    var dataAdmissao = new Date(historicoPacientes[i].dataHoraAdmissao);
                    if (dataAdmissao >= new Date(dataInicio) && dataAdmissao <= new Date(dataFim)) {
                        dadosFiltrados.push(historicoPacientes[i]);
                    }
                }
            }
            
            var content = document.getElementById('relatorioContent');
            
            switch (tipoRelatorio) {
                case 'tempo':
                    content.innerHTML = gerarRelatorioTempo(dadosFiltrados);
                    break;
                case 'geral':
                    content.innerHTML = gerarRelatorioGeral(dadosFiltrados);
                    break;
                case 'ocupacao':
                    content.innerHTML = gerarRelatorioOcupacao(dadosFiltrados);
                    break;
                case 'origem':
                    content.innerHTML = gerarRelatorioOrigem(dadosFiltrados);
                    break;
            }
        }
        
        // FUNCAO PARA GERAR RELATORIO DE TEMPO
        function gerarRelatorioTempo(dados) {
            var html = '<h3>Relatorio de Tempo de Permanencia</h3><table><thead><tr><th>Paciente</th><th>Registro</th><th>Leito</th><th>Admissao</th><th>Saida</th><th>Tempo Total</th></tr></thead><tbody>';
            
            for (var i = 0; i < dados.length; i++) {
                var h = dados[i];
                if (h.dataHoraSaida) {
                    var inicio = new Date(h.dataHoraAdmissao);
                    var fim = new Date(h.dataHoraSaida);
                    var diffMs = fim - inicio;
                    var diffHoras = Math.floor(diffMs / (1000 * 60 * 60));
                    var diffMinutos = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                    
                    html += '<tr>';
                    html += '<td><strong>' + h.pacienteIniciais + '</strong></td>';
                    html += '<td>' + h.registro + '</td>';
                    html += '<td>' + h.leito + '</td>';
                    html += '<td>' + inicio.toLocaleString('pt-BR') + '</td>';
                    html += '<td>' + fim.toLocaleString('pt-BR') + '</td>';
                    html += '<td>' + diffHoras + 'h ' + diffMinutos + 'min</td>';
                    html += '</tr>';
                }
            }
            
            html += '</tbody></table>';
            return html;
        }
        
        // FUNCAO PARA GERAR RELATORIO GERAL
        function gerarRelatorioGeral(dados) {
            var html = '<h3>Relatorio Geral</h3><table><thead><tr><th>Paciente</th><th>Registro</th><th>Origem</th><th>Leito</th><th>Admissao</th><th>Saida</th><th>Status</th></tr></thead><tbody>';
            
            for (var i = 0; i < dados.length; i++) {
                var h = dados[i];
                html += '<tr>';
                html += '<td><strong>' + h.pacienteIniciais + '</strong></td>';
                html += '<td>' + h.registro + '</td>';
                html += '<td>' + h.origem + '</td>';
                html += '<td>' + h.leito + '</td>';
                html += '<td>' + new Date(h.dataHoraAdmissao).toLocaleString('pt-BR') + '</td>';
                html += '<td>' + (h.dataHoraSaida ? new Date(h.dataHoraSaida).toLocaleString('pt-BR') : 'Ainda no PA') + '</td>';
                html += '<td>' + h.status + '</td>';
                html += '</tr>';
            }
            
            html += '</tbody></table>';
            return html;
        }
        
        // FUNCAO PARA GERAR RELATORIO DE OCUPACAO
        function gerarRelatorioOcupacao(dados) {
            var ocupacaoPorLeito = {};
            
            for (var i = 0; i < dados.length; i++) {
                var h = dados[i];
                if (!ocupacaoPorLeito[h.leito]) {
                    ocupacaoPorLeito[h.leito] = 0;
                }
                ocupacaoPorLeito[h.leito]++;
            }
            
            var html = '<h3>Relatorio de Ocupacao por Leito</h3><table><thead><tr><th>Leito</th><th>Total de Pacientes</th></tr></thead><tbody>';
            
            for (var leito in ocupacaoPorLeito) {
                html += '<tr><td>' + leito + '</td><td>' + ocupacaoPorLeito[leito] + '</td></tr>';
            }
            
            html += '</tbody></table>';
            return html;
        }
        
        // FUNCAO PARA GERAR RELATORIO POR ORIGEM
        function gerarRelatorioOrigem(dados) {
            var origemCount = {};
            
            for (var i = 0; i < dados.length; i++) {
                var h = dados[i];
                origemCount[h.origem] = (origemCount[h.origem] || 0) + 1;
            }
            
            var html = '<h3>Relatorio por Origem</h3><table><thead><tr><th>Origem</th><th>Total de Pacientes</th></tr></thead><tbody>';
            
            for (var origem in origemCount) {
                html += '<tr><td>' + origem + '</td><td>' + origemCount[origem] + '</td></tr>';
            }
            
            html += '</tbody></table>';
            return html;
        }
        
        // FUNCAO PARA EXPORTAR RELATORIO
        function exportarRelatorio() {
            var dataInicio = document.getElementById('dataInicio').value;
            var dataFim = document.getElementById('dataFim').value;
            
            var dadosFiltrados = historicoPacientes;
            
            if (dataInicio && dataFim) {
                dadosFiltrados = [];
                for (var i = 0; i < historicoPacientes.length; i++) {
                    var dataAdmissao = new Date(historicoPacientes[i].dataHoraAdmissao);
                    if (dataAdmissao >= new Date(dataInicio) && dataAdmissao <= new Date(dataFim)) {
                        dadosFiltrados.push(historicoPacientes[i]);
                    }
                }
            }
            
            var csv = 'Paciente,Registro,Origem,Leito,Admissao,Saida,Status\n';
            
            for (var i = 0; i < dadosFiltrados.length; i++) {
                var h = dadosFiltrados[i];
                csv += h.pacienteIniciais + ',' + h.registro + ',' + h.origem + ',' + h.leito + ',' + 
                       new Date(h.dataHoraAdmissao).toLocaleString('pt-BR') + ',' + 
                       (h.dataHoraSaida ? new Date(h.dataHoraSaida).toLocaleString('pt-BR') : 'Ainda no PA') + ',' + 
                       h.status + '\n';
            }
            
            var blob = new Blob([csv], { type: 'text/csv' });
            var url = window.URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'relatorio_pa_' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // FUNCAO PARA TROCAR PAINEIS
        function switchPanel(panelName) {
            var panels = document.querySelectorAll('.panel');
            for (var i = 0; i < panels.length; i++) {
                panels[i].classList.remove('active');
            }
            
            var buttons = document.querySelectorAll('.view-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            
            var targetPanel = document.getElementById(panelName);
            if (targetPanel) {
                targetPanel.classList.add('active');
            } else {
                console.error('Painel n√£o encontrado:', panelName);
            }
            var activeButton = document.querySelector('.view-btn[onclick*="' + panelName + '"]');
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }
        
        // FUNCAO PARA MOSTRAR PA
        function mostrarPA() {
            switchPanel('paPanel');
        }
        
        // FECHAR MODAIS AO CLICAR FORA
        window.onclick = function(event) {
            var modalAdmitir = document.getElementById('modalAdmitir');
            var modalTransferir = document.getElementById('modalTransferir');
            
            if (event.target == modalAdmitir) {
                fecharModal();
            }
            if (event.target == modalTransferir) {
                fecharModalTransferir();
            }
        }
        
        // FUNCAO PARA TESTAR SOM (para debug)
        function testarSom() {
            console.log('Testando som...');
            tocarSomAdmissao();
        }
        
        // FUNCOES DE EMAIL
        function enviarEmailAdmissao(dadosPaciente) {
            if (!configEmail.ativo) return;
            
            var assunto = 'üîî NOVA ADMISS√ÉO - PA INMCEB';
            var corpo = gerarCorpoEmailAdmissao(dadosPaciente);
            
            configEmail.destinatarios.admissao.forEach(function(email) {
                enviarEmail(email, assunto, corpo);
            });
        }
        
        function enviarEmailTransferencia(dadosPaciente) {
            if (!configEmail.ativo) return;
            
            var assunto = 'üîÑ TRANSFER√äNCIA - PA INMCEB';
            var corpo = gerarCorpoEmailTransferencia(dadosPaciente);
            
            configEmail.destinatarios.transferencia.forEach(function(email) {
                enviarEmail(email, assunto, corpo);
            });
        }
        
        function enviarEmailAlta(dadosPaciente) {
            if (!configEmail.ativo) return;
            
            var assunto = '‚úÖ ALTA M√âDICA - PA INMCEB';
            var corpo = gerarCorpoEmailAlta(dadosPaciente);
            
            configEmail.destinatarios.alta.forEach(function(email) {
                enviarEmail(email, assunto, corpo);
            });
        }
        
        function gerarCorpoEmailAdmissao(dados) {
            return `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; border-radius: 10px 10px 0 0;">
                        <h2 style="margin: 0;">üè• INMCEB - NOVA ADMISS√ÉO</h2>
                        <p style="margin: 10px 0 0 0;">Pronto Atendimento Psiqui√°trico</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px;">
                        <h3 style="color: #333; margin-top: 0;">üìã Dados do Paciente</h3>
                        
                        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üë§ Paciente:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;"><strong>${dados.pacienteIniciais}</strong></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üî¢ Registro:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.registro}</td>
                            </tr>
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üè† Origem:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.origem}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üõèÔ∏è Leito:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.leito}</td>
                            </tr>
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">‚è∞ Admiss√£o:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${new Date(dados.dataHoraAdmissao).toLocaleString('pt-BR')}</td>
                            </tr>
                        </table>
                        
                        ${dados.observacoes ? `
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #856404;">üìù Observa√ß√µes:</h4>
                            <p style="margin: 0; color: #856404;">${dados.observacoes}</p>
                        </div>
                        ` : ''}
                        
                        <div style="background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #0c5460;">üíä A√ß√£o Necess√°ria:</h4>
                            <p style="margin: 0; color: #0c5460;">Preparar e enviar kit de medica√ß√µes para o <strong>Pronto Atendimento</strong>.</p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                            <p style="color: #6c757d; font-size: 12px; margin: 0;">
                                NexusCare - Conectando o cuidado, ponto a ponto<br>
                                Este √© um email autom√°tico do sistema.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function gerarCorpoEmailTransferencia(dados) {
            return `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; text-align: center; border-radius: 10px 10px 0 0;">
                        <h2 style="margin: 0;">üîÑ INMCEB - TRANSFER√äNCIA</h2>
                        <p style="margin: 10px 0 0 0;">Pronto Atendimento Psiqui√°trico</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px;">
                        <h3 style="color: #333; margin-top: 0;">üìã Dados da Transfer√™ncia</h3>
                        
                        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üë§ Paciente:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;"><strong>${dados.pacienteIniciais}</strong></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üî¢ Registro:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.registro}</td>
                            </tr>
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üè† Origem:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.origem}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üéØ Destino:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;"><strong style="color: #dc3545;">${dados.destino}</strong></td>
                            </tr>
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üõèÔ∏è Leito:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.leito}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">‚è∞ Sa√≠da:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${new Date(dados.dataHoraSaida).toLocaleString('pt-BR')}</td>
                            </tr>
                        </table>
                        
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #155724;">‚úÖ Status:</h4>
                            <p style="margin: 0; color: #155724;">Paciente transferido com sucesso para <strong>${dados.destino}</strong>.</p>
                        </div>
                        
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #856404;">üíä A√ß√£o Necess√°ria:</h4>
                            <p style="margin: 0; color: #856404;">Redirecionar kit de medica√ß√µes para <strong>${dados.destino}</strong>.</p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                            <p style="color: #6c757d; font-size: 12px; margin: 0;">
                                NexusCare - Conectando o cuidado, ponto a ponto<br>
                                Este √© um email autom√°tico do sistema.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function gerarCorpoEmailAlta(dados) {
            return `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; text-align: center; border-radius: 10px 10px 0 0;">
                        <h2 style="margin: 0;">‚úÖ INMCEB - ALTA M√âDICA</h2>
                        <p style="margin: 10px 0 0 0;">Pronto Atendimento Psiqui√°trico</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px;">
                        <h3 style="color: #333; margin-top: 0;">üìã Dados da Alta</h3>
                        
                        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üë§ Paciente:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;"><strong>${dados.pacienteIniciais}</strong></td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üî¢ Registro:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.registro}</td>
                            </tr>
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üè† Origem:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.origem}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">üõèÔ∏è Leito:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${dados.leito}</td>
                            </tr>
                            <tr style="background: #e9ecef;">
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">‚è∞ Entrada:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${new Date(dados.dataHoraEntrada).toLocaleString('pt-BR')}</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px; border: 1px solid #dee2e6; font-weight: bold;">‚è∞ Sa√≠da:</td>
                                <td style="padding: 12px; border: 1px solid #dee2e6;">${new Date(dados.dataHoraSaida).toLocaleString('pt-BR')}</td>
                            </tr>
                        </table>
                        
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #155724;">üéâ Status:</h4>
                            <p style="margin: 0; color: #155724;">Paciente recebeu alta m√©dica com sucesso!</p>
                        </div>
                        
                        <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #721c24;">‚ö†Ô∏è A√ß√£o Necess√°ria:</h4>
                            <p style="margin: 0; color: #721c24;">Interromper envio de kit de medica√ß√µes para este paciente.</p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                            <p style="color: #6c757d; font-size: 12px; margin: 0;">
                                NexusCare - Conectando o cuidado, ponto a ponto<br>
                                Este √© um email autom√°tico do sistema.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function enviarEmail(destinatario, assunto, corpo) {
            console.log('üìß Enviando email...');
            console.log('Para:', destinatario);
            console.log('Assunto:', assunto);
            
            // Tentar envio real usando EmailJS ou servi√ßo similar
            if (typeof emailjs !== 'undefined') {
                // Usando EmailJS para envio real
                enviarEmailReal(destinatario, assunto, corpo);
            } else {
                // Fallback: tentar usar mailto
                enviarEmailMailto(destinatario, assunto, corpo);
            }
        }
        
        function enviarEmailReal(destinatario, assunto, corpo) {
            // Usar as credenciais configuradas pelo usu√°rio
            var serviceId = (configEmail && configEmail.emailjs && configEmail.emailjs.serviceId) ? configEmail.emailjs.serviceId : 'service_inmceb';
            var templateId = (configEmail && configEmail.emailjs && configEmail.emailjs.templateId) ? configEmail.emailjs.templateId : 'template_pa';
            
            emailjs.send(serviceId, templateId, {
                to_email: destinatario,
                subject: assunto,
                message: corpo,
                from_name: 'Sistema PA INMCEB'
            })
            .then(function(response) {
                console.log('‚úÖ Email enviado com sucesso via EmailJS:', response);
                mostrarNotificacaoEmail(destinatario, assunto, true);
            })
            .catch(function(error) {
                console.log('‚ùå Erro ao enviar email via EmailJS:', error);
                // Fallback para mailto
                enviarEmailMailto(destinatario, assunto, corpo);
            });
        }
        
        function enviarEmailMailto(destinatario, assunto, corpo) {
            // Usar mailto como fallback
            var mailtoLink = 'mailto:' + destinatario + 
                           '?subject=' + encodeURIComponent(assunto) + 
                           '&body=' + encodeURIComponent(corpo);
            
            // Abrir cliente de email padr√£o
            window.open(mailtoLink);
            
            console.log('üìß Cliente de email aberto para:', destinatario);
            mostrarNotificacaoEmail(destinatario, assunto, false);
        }
        
        function mostrarNotificacaoEmail(destinatario, assunto, enviadoReal) {
            // Criar notifica√ß√£o visual de email enviado
            var notificacao = document.createElement('div');
            var corFundo = enviadoReal ? 
                'linear-gradient(135deg, #28a745 0%, #20c997 100%)' : 
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            var icone = enviadoReal ? '‚úÖ' : 'üìß';
            var status = enviadoReal ? 'Email Enviado!' : 'Cliente de Email Aberto';
            
            notificacao.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${corFundo};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                font-family: Arial, sans-serif;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            
            notificacao.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 5px;">
                    <span style="font-size: 20px; margin-right: 10px;">${icone}</span>
                    <strong>${status}</strong>
                </div>
                <div style="font-size: 12px; opacity: 0.9;">
                    Para: ${destinatario}<br>
                    Assunto: ${assunto}<br>
                    ${enviadoReal ? 'Enviado automaticamente' : 'Abra seu cliente de email'}
                </div>
            `;
            
            // Adicionar CSS para anima√ß√£o
            if (!document.getElementById('email-notification-style')) {
                var style = document.createElement('style');
                style.id = 'email-notification-style';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(notificacao);
            
            // Remover notifica√ß√£o ap√≥s 5 segundos
            setTimeout(function() {
                notificacao.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(function() {
                    if (notificacao.parentNode) {
                        notificacao.parentNode.removeChild(notificacao);
                    }
                }, 300);
            }, 5000);
        }
        
        // FUNCOES DE CONFIGURACAO DE EMAIL
        function mostrarConfigEmail() {
            // Verificar permiss√£o
            if (!usuarioLogado || !usuarioLogado.permissoes.configurarEmails) {
                alert('Voc√™ n√£o tem permiss√£o para configurar emails.');
                return;
            }
            
            switchPanel('configEmailPanel');
        }
        
        function toggleEmailSistema() {
            var checkbox = document.getElementById('emailAtivo');
            configEmail.ativo = checkbox.checked;
            
            var status = document.getElementById('statusConfigEmail');
            if (configEmail.ativo) {
                status.style.display = 'block';
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                status.style.border = '1px solid #c3e6cb';
                status.innerHTML = '‚úÖ Sistema de emails ativado';
            } else {
                status.style.display = 'block';
                status.style.background = '#f8d7da';
                status.style.color = '#721c24';
                status.style.border = '1px solid #f5c6cb';
                status.innerHTML = '‚ùå Sistema de emails desativado';
            }
            
            setTimeout(function() {
                status.style.display = 'none';
            }, 3000);
        }
        
        function adicionarEmail(tipo) {
            var container = document.getElementById('emails' + tipo.charAt(0).toUpperCase() + tipo.slice(1));
            var input = document.createElement('input');
            input.type = 'email';
            input.className = 'email-input';
            input.placeholder = 'novo@email.com';
            container.appendChild(input);
        }
        
        function salvarConfigEmail() {
            // Salvar destinat√°rios
            configEmail.destinatarios.admissao = [];
            document.querySelectorAll('#emailsAdmissao .email-input').forEach(function(input) {
                if (input.value.trim()) {
                    configEmail.destinatarios.admissao.push(input.value.trim());
                }
            });
            
            configEmail.destinatarios.transferencia = [];
            document.querySelectorAll('#emailsTransferencia .email-input').forEach(function(input) {
                if (input.value.trim()) {
                    configEmail.destinatarios.transferencia.push(input.value.trim());
                }
            });
            
            configEmail.destinatarios.alta = [];
            document.querySelectorAll('#emailsAlta .email-input').forEach(function(input) {
                if (input.value.trim()) {
                    configEmail.destinatarios.alta.push(input.value.trim());
                }
            });
            
            // Salvar configura√ß√µes SMTP
            configEmail.servidor.host = document.getElementById('smtpHost').value;
            configEmail.servidor.porta = parseInt(document.getElementById('smtpPorta').value);
            configEmail.servidor.usuario = document.getElementById('smtpUsuario').value;
            configEmail.servidor.senha = document.getElementById('smtpSenha').value;
            
            // Salvar configura√ß√µes EmailJS
            configEmail.metodoEnvio = document.querySelector('input[name="metodoEnvio"]:checked').value;
            configEmail.emailjs.serviceId = document.getElementById('emailjsServiceId').value;
            configEmail.emailjs.templateId = document.getElementById('emailjsTemplateId').value;
            configEmail.emailjs.publicKey = document.getElementById('emailjsPublicKey').value;
            
            // Salvar no localStorage
            localStorage.setItem('configEmail', JSON.stringify(configEmail));
            
            var status = document.getElementById('statusConfigEmail');
            status.style.display = 'block';
            status.style.background = '#d4edda';
            status.style.color = '#155724';
            status.style.border = '1px solid #c3e6cb';
            status.innerHTML = '‚úÖ Configura√ß√µes de email salvas com sucesso!';
            
            setTimeout(function() {
                status.style.display = 'none';
            }, 3000);
        }
        
        function testarEmail() {
            var dadosTeste = {
                pacienteIniciais: 'TESTE',
                registro: '12345',
                origem: 'APARTAMENTOS',
                leito: 'PA-01',
                dataHoraAdmissao: new Date().toISOString(),
                observacoes: 'Email de teste do sistema'
            };
            
            enviarEmailAdmissao(dadosTeste);
            
            var status = document.getElementById('statusConfigEmail');
            status.style.display = 'block';
            status.style.background = '#d1ecf1';
            status.style.color = '#0c5460';
            status.style.border = '1px solid #bee5eb';
            status.innerHTML = 'üìß Email de teste enviado! Verifique o console e as notifica√ß√µes.';
            
            setTimeout(function() {
                status.style.display = 'none';
            }, 5000);
        }
        
        function carregarConfigEmail() {
            var configSalva = localStorage.getItem('configEmail');
            if (configSalva) {
                configEmail = JSON.parse(configSalva);
                
                // Atualizar interface
                document.getElementById('emailAtivo').checked = configEmail.ativo;
                
                // Atualizar destinat√°rios
                var emailsAdmissao = document.getElementById('emailsAdmissao');
                emailsAdmissao.innerHTML = '';
                configEmail.destinatarios.admissao.forEach(function(email) {
                    var input = document.createElement('input');
                    input.type = 'email';
                    input.className = 'email-input';
                    input.value = email;
                    emailsAdmissao.appendChild(input);
                });
                
                var emailsTransferencia = document.getElementById('emailsTransferencia');
                emailsTransferencia.innerHTML = '';
                configEmail.destinatarios.transferencia.forEach(function(email) {
                    var input = document.createElement('input');
                    input.type = 'email';
                    input.className = 'email-input';
                    input.value = email;
                    emailsTransferencia.appendChild(input);
                });
                
                var emailsAlta = document.getElementById('emailsAlta');
                emailsAlta.innerHTML = '';
                configEmail.destinatarios.alta.forEach(function(email) {
                    var input = document.createElement('input');
                    input.type = 'email';
                    input.className = 'email-input';
                    input.value = email;
                    emailsAlta.appendChild(input);
                });
                
                // Atualizar SMTP
                document.getElementById('smtpHost').value = configEmail.servidor.host;
                document.getElementById('smtpPorta').value = configEmail.servidor.porta;
                document.getElementById('smtpUsuario').value = configEmail.servidor.usuario;
                document.getElementById('smtpSenha').value = configEmail.servidor.senha;
                
                // Atualizar EmailJS
                if (configEmail.metodoEnvio) {
                    document.querySelector('input[name="metodoEnvio"][value="' + configEmail.metodoEnvio + '"]').checked = true;
                    alterarMetodoEnvio();
                }
                document.getElementById('emailjsServiceId').value = configEmail.emailjs.serviceId || '';
                document.getElementById('emailjsTemplateId').value = configEmail.emailjs.templateId || '';
                document.getElementById('emailjsPublicKey').value = configEmail.emailjs.publicKey || '';
            }
        }
        
        // FUNCOES DE RELATORIOS AUTOMATICOS
        function enviarRelatorioAutomatico() {
            if (!configEmail.ativo || !configEmail.relatoriosAutomaticos.ativo) return;
            
            var hoje = new Date();
            var ontem = new Date(hoje);
            ontem.setDate(hoje.getDate() - 1);
            
            var dadosFiltrados = historicoPacientes.filter(function(paciente) {
                var dataPaciente = new Date(paciente.dataHoraEntrada);
                return dataPaciente >= ontem && dataPaciente <= hoje;
            });
            
            var assunto = 'üìä Relat√≥rio Di√°rio - PA INMCEB - ' + hoje.toLocaleDateString('pt-BR');
            var corpo = gerarCorpoRelatorioAutomatico(dadosFiltrados, hoje);
            
            configEmail.destinatarios.relatorios.forEach(function(email) {
                enviarEmail(email, assunto, corpo);
            });
            
            console.log('üìä Relat√≥rio autom√°tico enviado para:', configEmail.destinatarios.relatorios);
        }
        
        function gerarCorpoRelatorioAutomatico(dados, data) {
            var totalPacientes = dados.length;
            var admissoes = dados.filter(p => p.status === 'EM ATENDIMENTO' || p.status === 'TRANSFERIDO' || p.status === 'ALTA').length;
            var altas = dados.filter(p => p.status === 'ALTA').length;
            var transferencias = dados.filter(p => p.status === 'TRANSFERIDO').length;
            var ocupacaoAtual = Object.keys(dadosLeitos).length;
            
            return `
                <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; border-radius: 10px 10px 0 0;">
                        <h2 style="margin: 0;">üìä INMCEB - RELAT√ìRIO DI√ÅRIO</h2>
                        <p style="margin: 10px 0 0 0;">Pronto Atendimento Psiqui√°trico</p>
                        <p style="margin: 5px 0 0 0; font-size: 14px;">${data.toLocaleDateString('pt-BR')}</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 0 0 10px 10px;">
                        <h3 style="color: #333; margin-top: 0;">üìà Resumo do Dia</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                                <h4 style="margin: 0; color: #1976d2;">üë• Total de Pacientes</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0; color: #1976d2;">${totalPacientes}</p>
                            </div>
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                                <h4 style="margin: 0; color: #388e3c;">üè• Ocupa√ß√£o Atual</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0; color: #388e3c;">${ocupacaoAtual}/15</p>
                            </div>
                            <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
                                <h4 style="margin: 0; color: #f57c00;">‚úÖ Altas</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0; color: #f57c00;">${altas}</p>
                            </div>
                            <div style="background: #fce4ec; padding: 15px; border-radius: 8px; text-align: center;">
                                <h4 style="margin: 0; color: #c2185b;">üîÑ Transfer√™ncias</h4>
                                <p style="font-size: 24px; font-weight: bold; margin: 5px 0; color: #c2185b;">${transferencias}</p>
                            </div>
                        </div>
                        
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 20px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #856404;">üìã Detalhes dos Pacientes</h4>
                            ${dados.length > 0 ? `
                                <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                    <tr style="background: #f8f9fa;">
                                        <th style="padding: 8px; border: 1px solid #dee2e6; text-align: left;">Paciente</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6; text-align: left;">Leito</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6; text-align: left;">Origem</th>
                                        <th style="padding: 8px; border: 1px solid #dee2e6; text-align: left;">Status</th>
                                    </tr>
                                    ${dados.map(p => `
                                        <tr>
                                            <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>${p.pacienteIniciais}</strong></td>
                                            <td style="padding: 8px; border: 1px solid #dee2e6;">${p.leito}</td>
                                            <td style="padding: 8px; border: 1px solid #dee2e6;">${p.origem}</td>
                                            <td style="padding: 8px; border: 1px solid #dee2e6;">${p.status}</td>
                                        </tr>
                                    `).join('')}
                                </table>
                            ` : '<p style="color: #856404; margin: 0;">Nenhum paciente atendido hoje.</p>'}
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #dee2e6;">
                            <p style="color: #6c757d; font-size: 12px; margin: 0;">
                                NexusCare - Conectando o cuidado, ponto a ponto<br>
                                Relat√≥rio gerado automaticamente em ${new Date().toLocaleString('pt-BR')}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // FUNCOES DE NOTIFICACOES PUSH
        function solicitarPermissaoPush() {
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    configPush.permissoes = permission === 'granted';
                    if (configPush.permissoes) {
                        console.log('‚úÖ Permiss√£o para notifica√ß√µes push concedida');
                        iniciarNotificacoesPush();
                    } else {
                        console.log('‚ùå Permiss√£o para notifica√ß√µes push negada');
                    }
                });
            } else {
                console.log('‚ùå Navegador n√£o suporta notifica√ß√µes push');
            }
        }
        
        function iniciarNotificacoesPush() {
            if (!configPush.ativo || !configPush.permissoes) return;
            
            setInterval(function() {
                verificarNovasMovimentacoes();
            }, configPush.intervalo);
        }
        
        function verificarNovasMovimentacoes() {
            // Verificar se h√° novas movimenta√ß√µes desde a √∫ltima verifica√ß√£o
            var ultimaVerificacao = localStorage.getItem('ultimaVerificacaoPush') || new Date().toISOString();
            var novasMovimentacoes = historicoPacientes.filter(function(paciente) {
                return new Date(paciente.dataHoraEntrada) > new Date(ultimaVerificacao);
            });
            
            if (novasMovimentacoes.length > 0) {
                novasMovimentacoes.forEach(function(movimentacao) {
                    mostrarNotificacaoPush(movimentacao);
                });
                
                localStorage.setItem('ultimaVerificacaoPush', new Date().toISOString());
            }
        }
        
        function mostrarNotificacaoPush(dados) {
            if (!configPush.permissoes) return;
            
            var titulo = '';
            var corpo = '';
            var icone = '';
            
            switch(dados.status) {
                case 'EM ATENDIMENTO':
                    titulo = 'üîî Nova Admiss√£o';
                    corpo = `Paciente ${dados.pacienteIniciais} admitido no ${dados.leito}`;
                    icone = '/favicon.ico';
                    break;
                case 'TRANSFERIDO':
                    titulo = 'üîÑ Transfer√™ncia';
                    corpo = `Paciente ${dados.pacienteIniciais} transferido para ${dados.destino}`;
                    icone = '/favicon.ico';
                    break;
                case 'ALTA':
                    titulo = '‚úÖ Alta M√©dica';
                    corpo = `Paciente ${dados.pacienteIniciais} recebeu alta`;
                    icone = '/favicon.ico';
                    break;
            }
            
            var notificacao = new Notification(titulo, {
                body: corpo,
                icon: icone,
                tag: 'pa-inmceb-' + dados.leito
            });
            
            notificacao.onclick = function() {
                window.focus();
                notificacao.close();
            };
            
            setTimeout(function() {
                notificacao.close();
            }, 5000);
        }
        
        // FUNCOES DE BACKUP AUTOMATICO
        function fazerBackupAutomatico() {
            if (!configBackup.ativo) return;
            
            var dadosBackup = {
                timestamp: new Date().toISOString(),
                dadosLeitos: dadosLeitos,
                historicoPacientes: historicoPacientes,
                configEmail: configEmail,
                configPush: configPush,
                configBackup: configBackup
            };
            
            var backupKey = 'backup_' + new Date().toISOString().split('T')[0];
            localStorage.setItem(backupKey, JSON.stringify(dadosBackup));
            
            // Limpar backups antigos
            limparBackupsAntigos();
            
            console.log('üíæ Backup autom√°tico realizado:', backupKey);
        }
        
        function limparBackupsAntigos() {
            var hoje = new Date();
            var limite = new Date(hoje);
            limite.setDate(hoje.getDate() - configBackup.manterBackups);
            
            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key && key.startsWith('backup_')) {
                    var dataBackup = new Date(key.replace('backup_', ''));
                    if (dataBackup < limite) {
                        localStorage.removeItem(key);
                        console.log('üóëÔ∏è Backup antigo removido:', key);
                    }
                }
            }
        }
        
        function restaurarBackup(data) {
            var backupKey = 'backup_' + data;
            var backup = localStorage.getItem(backupKey);
            
            if (backup) {
                var dadosBackup = JSON.parse(backup);
                dadosLeitos = dadosBackup.dadosLeitos || {};
                historicoPacientes = dadosBackup.historicoPacientes || [];
                configEmail = dadosBackup.configEmail || configEmail;
                configPush = dadosBackup.configPush || configPush;
                configBackup = dadosBackup.configBackup || configBackup;
                
                console.log('üîÑ Backup restaurado:', data);
                alert('Backup restaurado com sucesso!');
            } else {
                alert('Backup n√£o encontrado para a data selecionada.');
            }
        }
        
        // FUNCAO PARA ATIVAR AUDIO CONTEXT (necess√°rio em alguns navegadores)
        function ativarAudioContext() {
            try {
                if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                    var audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    if (audioContext.state === 'suspended') {
                        audioContext.resume().then(function() {
                            console.log('AudioContext ativado');
                        });
                    }
                }
            } catch (e) {
                console.log('Erro ao ativar AudioContext:', e);
            }
        }
        
        // ATIVAR AUDIO CONTEXT NO PRIMEIRO CLIQUE
        document.addEventListener('click', function() {
            ativarAudioContext();
        }, { once: true });
        
        // FUNCOES DE CONFIGURACAO AVANCADA
        function mostrarConfigAvancada() {
            // Verificar permiss√£o
            if (!usuarioLogado || !usuarioLogado.permissoes.configurarAvancado) {
                alert('Voc√™ n√£o tem permiss√£o para acessar configura√ß√µes avan√ßadas.');
                return;
            }
            
            switchPanel('configAvancadaPanel');
        }
        
        function toggleRelatoriosAutomaticos() {
            var checkbox = document.getElementById('relatoriosAutomaticos');
            configEmail.relatoriosAutomaticos.ativo = checkbox.checked;
        }
        
        function toggleNotificacoesPush() {
            var checkbox = document.getElementById('notificacoesPush');
            configPush.ativo = checkbox.checked;
        }
        
        function toggleBackupAutomatico() {
            var checkbox = document.getElementById('backupAutomatico');
            configBackup.ativo = checkbox.checked;
        }
        
        function toggleWhatsApp() {
            var checkbox = document.getElementById('whatsappAtivo');
            // Implementar configura√ß√£o WhatsApp
        }
        
        function testarRelatorioAutomatico() {
            enviarRelatorioAutomatico();
            
            var status = document.getElementById('statusConfigAvancada');
            status.style.display = 'block';
            status.style.background = '#d1ecf1';
            status.style.color = '#0c5460';
            status.style.border = '1px solid #bee5eb';
            status.innerHTML = 'üìä Relat√≥rio de teste enviado! Verifique os emails configurados.';
            
            setTimeout(function() {
                status.style.display = 'none';
            }, 5000);
        }
        
        function fazerBackupManual() {
            fazerBackupAutomatico();
            
            var status = document.getElementById('statusConfigAvancada');
            status.style.display = 'block';
            status.style.background = '#d4edda';
            status.style.color = '#155724';
            status.style.border = '1px solid #c3e6cb';
            status.innerHTML = 'üíæ Backup manual realizado com sucesso!';
            
            setTimeout(function() {
                status.style.display = 'none';
            }, 3000);
        }
        
        function mostrarBackupsDisponiveis() {
            var backups = [];
            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key && key.startsWith('backup_')) {
                    var data = key.replace('backup_', '');
                    backups.push(data);
                }
            }
            
            if (backups.length > 0) {
                var lista = backups.map(function(backup) {
                    return '<option value="' + backup + '">' + backup + '</option>';
                }).join('');
                
                var select = '<select id="backupSelect" class="filter-input" style="margin: 10px 0;">' + lista + '</select>';
                var botao = '<button onclick="restaurarBackupSelecionado()" class="btn-primary" style="margin-left: 10px;">Restaurar</button>';
                
                var status = document.getElementById('statusConfigAvancada');
                status.style.display = 'block';
                status.style.background = '#e3f2fd';
                status.style.color = '#0d47a1';
                status.style.border = '1px solid #bbdefb';
                status.innerHTML = '<h4>Backups Dispon√≠veis:</h4>' + select + botao;
            } else {
                var status = document.getElementById('statusConfigAvancada');
                status.style.display = 'block';
                status.style.background = '#fff3cd';
                status.style.color = '#856404';
                status.style.border = '1px solid #ffeaa7';
                status.innerHTML = 'Nenhum backup encontrado.';
            }
        }
        
        function restaurarBackupSelecionado() {
            var select = document.getElementById('backupSelect');
            if (select && select.value) {
                restaurarBackup(select.value);
            }
        }
        
        function testarWhatsApp() {
            var numero = document.getElementById('numeroWhatsApp').value;
            if (numero) {
                var mensagem = 'Teste do sistema PA INMCEB - ' + new Date().toLocaleString('pt-BR');
                var url = 'https://wa.me/' + numero + '?text=' + encodeURIComponent(mensagem);
                window.open(url, '_blank');
                
                var status = document.getElementById('statusConfigAvancada');
                status.style.display = 'block';
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                status.style.border = '1px solid #c3e6cb';
                status.innerHTML = 'üì± WhatsApp aberto para teste!';
                
                setTimeout(function() {
                    status.style.display = 'none';
                }, 3000);
            } else {
                alert('Por favor, insira um n√∫mero de WhatsApp v√°lido.');
            }
        }
        
        // FUNCOES DE INTEGRACAO WHATSAPP
        function enviarWhatsAppAdmissao(dadosPaciente) {
            var mensagem = gerarMensagemWhatsAppAdmissao(dadosPaciente);
            enviarWhatsApp(mensagem);
        }
        
        function enviarWhatsAppTransferencia(dadosPaciente) {
            var mensagem = gerarMensagemWhatsAppTransferencia(dadosPaciente);
            enviarWhatsApp(mensagem);
        }
        
        function enviarWhatsAppAlta(dadosPaciente) {
            var mensagem = gerarMensagemWhatsAppAlta(dadosPaciente);
            enviarWhatsApp(mensagem);
        }
        
        function gerarMensagemWhatsAppAdmissao(dados) {
            return `üè• *NOVA ADMISS√ÉO - PA INMCEB*

üë§ *Paciente:* ${dados.pacienteIniciais}
üè• *Leito:* ${dados.leito}
üìç *Origem:* ${dados.origem}
üìÖ *Data/Hora:* ${dados.dataHoraEntrada}
üìù *Observa√ß√µes:* ${dados.observacoes || 'Nenhuma'}

‚ö†Ô∏è *A√á√ÉO NECESS√ÅRIA:*
- Preparar kit de medica√ß√µes para o PA
- Verificar disponibilidade do leito
- Notificar equipe m√©dica

---
Sistema PA INMCEB - ${new Date().toLocaleString('pt-BR')}`;
        }
        
        function gerarMensagemWhatsAppTransferencia(dados) {
            return `üîÑ *TRANSFER√äNCIA - PA INMCEB*

üë§ *Paciente:* ${dados.pacienteIniciais}
üè• *Leito Origem:* ${dados.leito}
üìç *Destino:* ${dados.destino}
üìÖ *Data/Hora:* ${dados.dataHoraTransferencia}
üìù *Observa√ß√µes:* ${dados.observacoes || 'Nenhuma'}

‚ö†Ô∏è *A√á√ÉO NECESS√ÅRIA:*
- Transferir kit de medica√ß√µes para ${dados.destino}
- Atualizar controle de leitos
- Notificar equipe de destino

---
Sistema PA INMCEB - ${new Date().toLocaleString('pt-BR')}`;
        }
        
        function gerarMensagemWhatsAppAlta(dados) {
            return `‚úÖ *ALTA M√âDICA - PA INMCEB*

üë§ *Paciente:* ${dados.pacienteIniciais}
üè• *Leito:* ${dados.leito}
üìÖ *Data/Hora Alta:* ${dados.dataHoraSaida}
üìù *Observa√ß√µes:* ${dados.observacoes || 'Nenhuma'}

‚ö†Ô∏è *A√á√ÉO NECESS√ÅRIA:*
- Leito dispon√≠vel para novo paciente
- Finalizar controle de medica√ß√µes
- Atualizar relat√≥rios

---
Sistema PA INMCEB - ${new Date().toLocaleString('pt-BR')}`;
        }
        
        function enviarWhatsApp(mensagem) {
            // Verificar se WhatsApp est√° configurado
            var numero = document.getElementById('numeroWhatsApp').value;
            if (!numero) {
                console.log('WhatsApp n√£o configurado');
                return;
            }
            
            // M√©todo 1: WhatsApp Web (gratuito)
            var url = 'https://wa.me/' + numero + '?text=' + encodeURIComponent(mensagem);
            window.open(url, '_blank');
            
            // M√©todo 2: API Externa (se configurada)
            if (configWhatsApp.apiKey) {
                enviarWhatsAppAPI(numero, mensagem);
            }
            
            console.log('üì± WhatsApp enviado para:', numero);
        }
        
        function enviarWhatsAppAPI(numero, mensagem) {
            // Exemplo com API externa (Twilio, MessageBird, etc.)
            var apiUrl = 'https://api.whatsapp.com/send'; // Substitua pela API real
            var dados = {
                to: numero,
                message: mensagem,
                api_key: configWhatsApp.apiKey
            };
            
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dados)
            })
            .then(response => response.json())
            .then(data => {
                console.log('‚úÖ WhatsApp API enviado:', data);
            })
            .catch(error => {
                console.log('‚ùå Erro WhatsApp API:', error);
            });
        }
        
        function salvarConfigAvancada() {
            // Salvar configura√ß√µes de relat√≥rios
            configEmail.relatoriosAutomaticos.ativo = document.getElementById('relatoriosAutomaticos').checked;
            configEmail.relatoriosAutomaticos.frequencia = document.getElementById('frequenciaRelatorios').value;
            configEmail.relatoriosAutomaticos.horario = document.getElementById('horarioRelatorios').value;
            
            // Salvar configura√ß√µes de push
            configPush.ativo = document.getElementById('notificacoesPush').checked;
            configPush.intervalo = parseInt(document.getElementById('intervaloPush').value) * 1000;
            
            // Salvar configura√ß√µes de backup
            configBackup.ativo = document.getElementById('backupAutomatico').checked;
            configBackup.frequencia = document.getElementById('frequenciaBackup').value;
            configBackup.manterBackups = parseInt(document.getElementById('manterBackups').value);
            
            // Salvar no localStorage
            localStorage.setItem('configEmail', JSON.stringify(configEmail));
            localStorage.setItem('configPush', JSON.stringify(configPush));
            localStorage.setItem('configBackup', JSON.stringify(configBackup));
            
            var status = document.getElementById('statusConfigAvancada');
            status.style.display = 'block';
            status.style.background = '#d4edda';
            status.style.color = '#155724';
            status.style.border = '1px solid #c3e6cb';
            status.innerHTML = '‚úÖ Todas as configura√ß√µes avan√ßadas salvas com sucesso!';
            
            setTimeout(function() {
                status.style.display = 'none';
            }, 3000);
        }
        
        // INICIALIZAR SISTEMAS AUTOMATICOS
        function inicializarSistemasAutomaticos() {
            // Inicializar backup autom√°tico
            if (configBackup.ativo) {
                setInterval(fazerBackupAutomatico, configBackup.frequencia === 'hora' ? 3600000 : 86400000);
            }
            
            // Inicializar relat√≥rios autom√°ticos
            if (configEmail.relatoriosAutomaticos.ativo) {
                verificarHorarioRelatorio();
            }
            
            // Inicializar notifica√ß√µes push
            if (configPush.ativo && configPush.permissoes) {
                iniciarNotificacoesPush();
            }
        }
        
        function verificarHorarioRelatorio() {
            var agora = new Date();
            var horarioConfigurado = configEmail.relatoriosAutomaticos.horario.split(':');
            var horaConfigurada = parseInt(horarioConfigurado[0]);
            var minutoConfigurado = parseInt(horarioConfigurado[1]);
            
            if (agora.getHours() === horaConfigurada && agora.getMinutes() === minutoConfigurado) {
                enviarRelatorioAutomatico();
            }
            
            // Verificar a cada minuto
            setTimeout(verificarHorarioRelatorio, 60000);
        }
        
        // CARREGAR CONFIGURACOES DE EMAIL
        document.addEventListener('DOMContentLoaded', function() {
            inicializarFirebase();
            carregarConfigEmail();
            inicializarEmailJS();
            inicializarSistemasAutomaticos();
            verificarSessao();
        });
        
        // FUNCOES DO FIREBASE
        let db;
        let firebaseConfig = {
            // CONFIGURA√á√ïES DO FIREBASE - PROJETO: nexuscare-inmceb
            apiKey: "AIzaSyBg9xjIVPuKZQyiENMcW0903FQBdvIDyRU",
            authDomain: "nexuscare-inmceb.firebaseapp.com",
            projectId: "nexuscare-inmceb",
            storageBucket: "nexuscare-inmceb.appspot.com",
            messagingSenderId: "600913039133",
            appId: "1:600913039133:web:exemplo123456"
        };
        
        function inicializarFirebase() {
            try {
                // Inicializar Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log('‚úÖ Firebase inicializado com sucesso');
                
                // Configurar listeners em tempo real
                configurarListenersTempoReal();
            } catch (error) {
                console.log('‚ùå Erro ao inicializar Firebase:', error);
                // Continuar sem Firebase se houver erro
            }
        }
        
        function configurarListenersTempoReal() {
            if (!db) {
                console.log('‚ùå Firebase n√£o inicializado, pulando listeners');
                return;
            }
            
            console.log('üîÑ Configurando listeners de tempo real...');
            
            // Listener para dados dos leitos
            db.collection('leitos').onSnapshot(function(snapshot) {
                console.log('üì° Mudan√ßa detectada na cole√ß√£o leitos:', snapshot.docChanges().length, 'mudan√ßas');
                snapshot.docChanges().forEach(function(change) {
                    console.log('üîÑ Tipo de mudan√ßa:', change.type, 'Documento:', change.doc.id);
                    if (change.type === 'modified' || change.type === 'added') {
                        const dados = change.doc.data();
                        console.log('üìä Dados do leito:', change.doc.id, dados);
                        atualizarLeitoLocal(change.doc.id, dados);
                    }
                });
            }, function(error) {
                console.error('‚ùå Erro no listener de leitos:', error);
            });
            
            // Listener para hist√≥rico de pacientes
            db.collection('historico').onSnapshot(function(snapshot) {
                snapshot.docChanges().forEach(function(change) {
                    if (change.type === 'added') {
                        const dados = change.doc.data();
                        adicionarHistoricoLocal(dados);
                    }
                });
            });
        }
        
        function salvarNoFirebase(colecao, documento, dados) {
            if (!db) {
                // Fallback para localStorage se Firebase n√£o estiver dispon√≠vel
                return salvarLocalStorage(colecao, documento, dados);
            }
            
            return db.collection(colecao).doc(documento).set(dados)
                .then(function() {
                    console.log('‚úÖ Dados salvos no Firebase:', colecao, documento);
                })
                .catch(function(error) {
                    console.error('‚ùå Erro ao salvar no Firebase:', error);
                    // Fallback para localStorage
                    return salvarLocalStorage(colecao, documento, dados);
                });
        }
        
        function carregarDoFirebase(colecao, documento) {
            if (!db) {
                // Fallback para localStorage se Firebase n√£o estiver dispon√≠vel
                return carregarLocalStorage(colecao, documento);
            }
            
            return db.collection(colecao).doc(documento).get()
                .then(function(doc) {
                    if (doc.exists) {
                        console.log('‚úÖ Dados carregados do Firebase:', colecao, documento);
                        return doc.data();
                    } else {
                        console.log('‚ö†Ô∏è Documento n√£o encontrado no Firebase:', colecao, documento);
                        return null;
                    }
                })
                .catch(function(error) {
                    console.error('‚ùå Erro ao carregar do Firebase:', error);
                    // Fallback para localStorage
                    return carregarLocalStorage(colecao, documento);
                });
        }
        
        function salvarLocalStorage(colecao, documento, dados) {
            const chave = colecao + '_' + documento;
            localStorage.setItem(chave, JSON.stringify(dados));
            console.log('üíæ Dados salvos no localStorage:', chave);
        }
        
        function carregarLocalStorage(colecao, documento) {
            const chave = colecao + '_' + documento;
            const dados = localStorage.getItem(chave);
            if (dados) {
                console.log('üíæ Dados carregados do localStorage:', chave);
                return JSON.parse(dados);
            }
            return null;
        }
        
        function atualizarLeitoLocal(leitoId, dados) {
            // Atualizar interface local quando dados mudarem no Firebase
            console.log('üîÑ Atualizando leito via Firebase:', leitoId, dados);
            dadosLeitos[leitoId] = dados;
            
            // Verificar se o leito est√° vago ou ocupado
            if (dados.status === 'VAGO' || !dados.pacienteIniciais) {
                console.log('üîÑ Leito vago detectado, limpando interface...');
                limparLeito(leitoId);
            } else {
                console.log('üîÑ Leito ocupado detectado, atualizando interface...');
                atualizarLeito(leitoId, dados);
            }
            
            // Atualizar interface se estiver na aba correta
            if (document.getElementById('paPanel').classList.contains('active')) {
                console.log('üîÑ Atualizando interface dos leitos...');
                renderizarLeitos();
            }
            
            // Atualizar farm√°cia sempre (independente de estar ativa)
            console.log('üîÑ Atualizando interface da farm√°cia...');
            renderizarFarmacia();
        }
        
        function adicionarHistoricoLocal(dados) {
            // Adicionar ao hist√≥rico local quando novo registro for criado no Firebase
            historicoPacientes.push(dados);
            if (typeof renderizarRastreabilidade === 'function') {
                renderizarRastreabilidade();
            }
        }
        
        // FUNCOES DE CONFIGURACAO EMAILJS
        function inicializarEmailJS() {
            // Carregar EmailJS se n√£o estiver carregado
            if (typeof emailjs === 'undefined') {
                var script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
                script.onload = function() {
                    // Inicializar com a chave p√∫blica se estiver configurada
                    setTimeout(function() {
                        if (configEmail && configEmail.emailjs && configEmail.emailjs.publicKey) {
                            emailjs.init(configEmail.emailjs.publicKey);
                            console.log('‚úÖ EmailJS inicializado com sucesso');
                        }
                    }, 100);
                };
                document.head.appendChild(script);
            } else if (configEmail && configEmail.emailjs && configEmail.emailjs.publicKey) {
                emailjs.init(configEmail.emailjs.publicKey);
                console.log('‚úÖ EmailJS inicializado com sucesso');
            }
        }
        
        function alterarMetodoEnvio() {
            var metodo = document.querySelector('input[name="metodoEnvio"]:checked').value;
            var configEmailJS = document.getElementById('configEmailJS');
            var configSMTP = document.getElementById('configSMTP');
            
            if (metodo === 'emailjs') {
                configEmailJS.style.display = 'block';
                configSMTP.style.display = 'none';
            } else {
                configEmailJS.style.display = 'none';
                configSMTP.style.display = 'block';
            }
        }
        
        function testarConfigEmailJS() {
            var serviceId = document.getElementById('emailjsServiceId').value;
            var templateId = document.getElementById('emailjsTemplateId').value;
            var publicKey = document.getElementById('emailjsPublicKey').value;
            
            if (!serviceId || !templateId || !publicKey) {
                alert('Por favor, preencha todos os campos do EmailJS.');
                return;
            }
            
            // Inicializar EmailJS
            if (typeof emailjs === 'undefined') {
                // Carregar EmailJS dinamicamente
                var script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
                script.onload = function() {
                    emailjs.init(publicKey);
                    enviarEmailTeste();
                };
                document.head.appendChild(script);
            } else {
                emailjs.init(publicKey);
                enviarEmailTeste();
            }
        }
        
        function enviarEmailTeste() {
            var serviceId = document.getElementById('emailjsServiceId').value;
            var templateId = document.getElementById('emailjsTemplateId').value;
            
            var dadosTeste = {
                to_email: 'teste@inmceb.com',
                subject: 'üß™ Teste de Configura√ß√£o - PA INMCEB',
                message: `
                    <h2>‚úÖ Configura√ß√£o EmailJS Funcionando!</h2>
                    <p>Este √© um email de teste do sistema PA INMCEB.</p>
                    <p><strong>Data/Hora:</strong> ${new Date().toLocaleString('pt-BR')}</p>
                    <p><strong>Status:</strong> Configura√ß√£o realizada com sucesso!</p>
                `,
                from_name: 'Sistema PA INMCEB'
            };
            
            emailjs.send(serviceId, templateId, dadosTeste)
                .then(function(response) {
                    console.log('‚úÖ Email de teste enviado com sucesso:', response);
                    mostrarStatusConfig('‚úÖ Configura√ß√£o EmailJS funcionando! Email de teste enviado.', 'success');
                })
                .catch(function(error) {
                    console.log('‚ùå Erro ao enviar email de teste:', error);
                    mostrarStatusConfig('‚ùå Erro na configura√ß√£o. Verifique as credenciais.', 'error');
                });
        }
        
        function mostrarExemploTemplate() {
            var modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-top: 0;">üìù Template de Email para EmailJS</h3>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h4>üìã Vari√°veis Dispon√≠veis:</h4>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li><code>{{to_email}}</code> - Email do destinat√°rio</li>
                            <li><code>{{subject}}</code> - Assunto do email</li>
                            <li><code>{{message}}</code> - Corpo do email (HTML)</li>
                            <li><code>{{from_name}}</code> - Nome do remetente</li>
                        </ul>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h4>üìß Exemplo de Template:</h4>
                        <pre style="background: #f8f9fa; padding: 10px; border-radius: 3px; font-size: 12px; overflow-x: auto;">
Assunto: {{subject}}

De: {{from_name}}
Para: {{to_email}}

{{message}}

---
Sistema PA INMCEB
Enviado automaticamente
                        </pre>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h4>‚ö†Ô∏è Dicas Importantes:</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                            <li>Use <code>{{message}}</code> para o corpo HTML do email</li>
                            <li>Configure o template no painel do EmailJS</li>
                            <li>Teste sempre antes de usar em produ√ß√£o</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="this.closest('.modal').remove()" class="btn-primary">Fechar</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }
        
        function mostrarStatusConfig(mensagem, tipo) {
            var status = document.getElementById('statusConfigEmail');
            status.style.display = 'block';
            
            if (tipo === 'success') {
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                status.style.border = '1px solid #c3e6cb';
            } else {
                status.style.background = '#f8d7da';
                status.style.color = '#721c24';
                status.style.border = '1px solid #f5c6cb';
            }
            
            status.innerHTML = mensagem;
            
            setTimeout(function() {
                status.style.display = 'none';
            }, 5000);
        }
        
        function mostrarGuiaWhatsApp() {
            var modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 900px; max-height: 90vh; overflow-y: auto;">
                    <h2 style="margin-top: 0; color: #2c3e50;">üì± Guia Completo - APIs WhatsApp</h2>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #1976d2;">üéØ Op√ß√µes Dispon√≠veis</h3>
                        <p style="margin: 0;">Escolha a melhor op√ß√£o para seu hospital baseado no or√ßamento e necessidades.</p>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #2e7d32;">üü¢ 1. WhatsApp Business API (Oficial)</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4>‚úÖ Vantagens:</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li>Oficial e confi√°vel</li>
                                    <li>Sem risco de bloqueio</li>
                                    <li>Suporte completo</li>
                                    <li>Mensagens ilimitadas</li>
                                </ul>
                            </div>
                            <div>
                                <h4>‚ùå Desvantagens:</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li>Processo de aprova√ß√£o complexo</li>
                                    <li>Custo por mensagem</li>
                                    <li>Requisitos de neg√≥cio</li>
                                </ul>
                            </div>
                        </div>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <strong>üí∞ Custo:</strong> ~$0.005-0.05 por mensagem<br>
                            <strong>üîó Link:</strong> <a href="https://business.whatsapp.com/products/business-api" target="_blank">business.whatsapp.com</a>
                        </div>
                    </div>
                    
                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #f57c00;">üîµ 2. WhatsApp Web API (N√£o Oficial)</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4>‚úÖ Vantagens:</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li>Gratuito</li>
                                    <li>F√°cil implementa√ß√£o</li>
                                    <li>Funciona imediatamente</li>
                                </ul>
                            </div>
                            <div>
                                <h4>‚ùå Desvantagens:</h4>
                                <ul style="margin: 0; padding-left: 20px;">
                                    <li>Pode ser bloqueado</li>
                                    <li>Limitado a 1 n√∫mero</li>
                                    <li>Sem garantias</li>
                                </ul>
                            </div>
                        </div>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <strong>üí∞ Custo:</strong> Gratuito<br>
                            <strong>üîó Exemplos:</strong> Baileys, WhatsApp Web JS
                        </div>
                    </div>
                    
                    <div style="background: #fce4ec; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #c2185b;">üü° 3. Servi√ßos Terceirizados</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                            <div>
                                <h4>Twilio</h4>
                                <p style="margin: 5px 0; font-size: 14px;">API robusta e confi√°vel</p>
                                <p style="margin: 0; font-size: 12px; color: #666;">~$0.005/msg</p>
                            </div>
                            <div>
                                <h4>MessageBird</h4>
                                <p style="margin: 5px 0; font-size: 14px;">Foco em empresas</p>
                                <p style="margin: 0; font-size: 12px; color: #666;">~$0.01/msg</p>
                            </div>
                            <div>
                                <h4>360Dialog</h4>
                                <p style="margin: 5px 0; font-size: 14px;">Especialista WhatsApp</p>
                                <p style="margin: 0; font-size: 12px; color: #666;">~$0.02/msg</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #e1f5fe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #0277bd;">‚öôÔ∏è Implementa√ß√£o no Sistema</h3>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                            <h4>M√©todo Atual (WhatsApp Web):</h4>
                            <pre style="background: #e9ecef; padding: 10px; border-radius: 3px; font-size: 12px; overflow-x: auto;">
// Abre WhatsApp Web com mensagem pr√©-formatada
var url = 'https://wa.me/' + numero + '?text=' + encodeURIComponent(mensagem);
window.open(url, '_blank');
                            </pre>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <h4>Para API Externa:</h4>
                            <pre style="background: #e9ecef; padding: 10px; border-radius: 3px; font-size: 12px; overflow-x: auto;">
// Substitua pela API escolhida
fetch('https://api.twilio.com/2010-04-01/Accounts/ACxxx/Messages.json', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: 'From=whatsapp:+14155238886&To=whatsapp:+5511999999999&Body=' + mensagem
});
                            </pre>
                        </div>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #856404;">üí° Recomenda√ß√£o para Hospitais:</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #856404;">
                            <li><strong>In√≠cio:</strong> Use WhatsApp Web (gratuito) para testes</li>
                            <li><strong>Produ√ß√£o:</strong> Migre para WhatsApp Business API</li>
                            <li><strong>Backup:</strong> Mantenha email como alternativa</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="this.closest('.modal').remove()" class="btn-primary">Fechar Guia</button>
                        <button onclick="window.open('https://business.whatsapp.com/', '_blank')" class="btn-secondary" style="margin-left: 10px;">WhatsApp Business</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }
        
        function mostrarGuiaCompleto() {
            var modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 800px; max-height: 90vh; overflow-y: auto;">
                    <h2 style="margin-top: 0; color: #2c3e50;">üìñ Guia Completo - Configura√ß√£o EmailJS</h2>
                    
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #1976d2;">üéØ Objetivo</h3>
                        <p style="margin: 0;">Configurar envio autom√°tico de emails para notificar admiss√µes, transfer√™ncias e altas de pacientes.</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #495057;">üìã Passo 1: Criar Conta no EmailJS</h3>
                        <ol style="margin: 0; padding-left: 20px;">
                            <li>Acesse <a href="https://www.emailjs.com/" target="_blank" style="color: #007bff;">www.emailjs.com</a></li>
                            <li>Clique em "Sign Up" e crie uma conta gratuita</li>
                            <li>Confirme seu email</li>
                            <li>Fa√ßa login na sua conta</li>
                        </ol>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #2e7d32;">üìß Passo 2: Configurar Servi√ßo de Email</h3>
                        <ol style="margin: 0; padding-left: 20px;">
                            <li>No painel do EmailJS, v√° em "Email Services"</li>
                            <li>Clique em "Add New Service"</li>
                            <li>Escolha seu provedor (Gmail, Outlook, etc.)</li>
                            <li>Configure as credenciais do seu email</li>
                            <li>Anote o <strong>Service ID</strong> gerado</li>
                        </ol>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
                            <strong>üí° Dica:</strong> Para Gmail, voc√™ precisar√° gerar uma "App Password" nas configura√ß√µes de seguran√ßa.
                        </div>
                    </div>
                    
                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #f57c00;">üìù Passo 3: Criar Template de Email</h3>
                        <ol style="margin: 0; padding-left: 20px;">
                            <li>V√° em "Email Templates"</li>
                            <li>Clique em "Create New Template"</li>
                            <li>Configure o template com as vari√°veis:</li>
                        </ol>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <strong>Vari√°veis do Template:</strong><br>
                            <code>{{to_email}}</code> - Email do destinat√°rio<br>
                            <code>{{subject}}</code> - Assunto do email<br>
                            <code>{{message}}</code> - Corpo do email (HTML)<br>
                            <code>{{from_name}}</code> - Nome do remetente
                        </div>
                        <p style="margin: 10px 0 0 0;"><strong>Anote o Template ID gerado</strong></p>
                    </div>
                    
                    <div style="background: #fce4ec; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #c2185b;">üîë Passo 4: Obter Public Key</h3>
                        <ol style="margin: 0; padding-left: 20px;">
                            <li>V√° em "Account" ‚Üí "General"</li>
                            <li>Encontre a se√ß√£o "API Keys"</li>
                            <li>Copie a <strong>Public Key</strong></li>
                        </ol>
                    </div>
                    
                    <div style="background: #e1f5fe; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #0277bd;">‚öôÔ∏è Passo 5: Configurar no Sistema</h3>
                        <ol style="margin: 0; padding-left: 20px;">
                            <li>Volte ao sistema PA INMCEB</li>
                            <li>Selecione "EmailJS (Envio Autom√°tico)"</li>
                            <li>Preencha os campos com as credenciais obtidas</li>
                            <li>Clique em "Testar Configura√ß√£o"</li>
                            <li>Se funcionar, clique em "Salvar Configura√ß√µes"</li>
                        </ol>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #856404;">‚ö†Ô∏è Importante:</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #856404;">
                            <li>Plano gratuito: 200 emails/m√™s</li>
                            <li>Para uso profissional, considere planos pagos</li>
                            <li>Teste sempre antes de usar em produ√ß√£o</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="this.closest('.modal').remove()" class="btn-primary">Fechar Guia</button>
                        <button onclick="window.open('https://www.emailjs.com/', '_blank')" class="btn-secondary" style="margin-left: 10px;">Abrir EmailJS</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
        }
        
        console.log('=== APLICACAO INICIADA ===');
        console.log('Para testar o som, digite: testarSom() no console');
        console.log('Sistema de emails configurado e pronto!');
    </script>
</body>
</html>
